{% extends 'base.html' %}
{% load static i18n %}
{% load myfilters static i18n %}
{% block extra_css %}
{{block.super}}

<style>
  .flatpickr-calendar{
    max-width: 400px;
    width: 100%;
    padding: 20px;
  }
  
  .rangeMode .flatpickr-day{
    margin-bottom: 10px;
    height: 36px;
    line-height: 36px;
  }
  
  .btn-date-range {
    align-items: center;
  }

  .btn-date-range .btn{
    width: 100%;
    text-align: center;
    padding: 10px;
  }
    
  .btn-group {
    max-width: 344px;
    width: 100%;
    border-radius: 7px;
  }

  .btn-group .btn {
    border: none;
    width: 50%;
  }

  .btn-group .btn:first-child {
    border-radius: 0px 7px 7px 0px !important;
  }

  .btn-group .btn:last-child {
    border-radius: 7px 0 0 7px !important;
  }

  .btn-group .dt-button span {
    font-size: 19px;
    line-height: 28px;
  }

  .flatpickr-innerContainer{
    margin-top: 10px;
  }

  .header-select{
    width: 200px;
  }

  .avatar-initial span {
    margin-top: 5px;
  }

  .image-card {
    padding: 8px;
  }

  .image-card .image-block {
    border-radius: 6px;
    display: block;
    margin-bottom: 6px;
  }

  .image-card .image-block img {
    width: 100%;
    height: auto;
    object-fit: cover;
  }

  .status-block {
    padding: 2px 8px; 
    font-weight: 400;
    font-size: 13px;
    color: #5AADDE;
    background: #EEF8FD;
    border-radius: 4px;
  }

  .job-card {
    padding: 9px;
    height: 100%;
  }

  .job-info {
    display: flex;
    align-items: end;
    justify-content: space-between;
  }

  .job-info .card-text {
    font-weight: 400;
    font-size: 14px;
    line-height: 21px;
    color: #32425E;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
    
  .job-slider-section .card-body{
    border-radius: 7px !important;
  }

  .card-title{
    display: flex;
    align-items: center;
    margin-bottom: 6px;
  }

  .card-title img {
    width: 25px;
    height: 25px;
  }

  .card-title span {
    font-weight: 500;
    font-size: 16px;
    line-height: 25px;
    color: #19253B;
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .fw-normal span{
    font-weight: 400;
    font-size: 16px;
    line-height: 24px;
    color: #32425E;
  }

  .carousel-inner img,.carousel-inner video{
    width: 100%;
    height: 200px;
    object-fit: cover;
  }

  .select2-container.select2-container--open{
    z-index: 111 !important;
  }

  .no-data-contain {
    height: 400px;
    display: flex;
    text-align: center;
    justify-content: center;
    align-items: center;
  }

  @media (max-width: 1440px) {
    .carousel-inner img, .carousel-inner video{
      height: 155px;
    }
  }

  @media (max-width: 1440px) {
    .header-select{
      width: 124px;
    }
  }
  .select2-results__option[aria-disabled=true]{
    display: none;
  }
</style>
{% endblock %}
{% block content %}


<div class="container-fluid flex-grow-1 container-p-y"> 
  <div class="row">
    <div class="col-xl-3 col-12">
      <h2 class="page-title">{% trans 'Job' %}</h2>
    </div>
    <div class="col-xl-5 col-md-6 text-xl-center mb-4 mb-md-0">
      <div class="btn-group">
        <button class="dt-button add-new btn btn-primary open-job" tabindex="1" aria-controls="DataTables_Table_0"
          type="button" href="#" data-bs-toggle="modal" data-bs-target="#show_open_job_modal" id="open_job_id" onclick="window.location.href = window.location.pathname+'?job=Open'">
          <span class="d-inline-block">
              {% trans 'Open' %}</span>
        </button>
        <button class="dt-button add-new btn btn-primary close-job" tabindex="1" aria-controls="DataTables_Table_0"
          type="button" href="#" data-bs-toggle="modal" data-bs-target="#show_close_job_modal" id="close_job_id" onclick="window.location.href = window.location.pathname+'?job=Close'">
          <span class="d-inline-block">
              {% trans 'Close' %}</span>
        </button>
      </div>
    </div>

    <!-- Add Group Button filter and Date Filter -->
    <div class="col-xl-4 col-md-6 text-end">
      <div class="header-btn-group">
        <!-- Group list for filter -->
        <form action="" method="GET" name="group" class="me-sm-3">
          <div class="form-group header-select">
            <select class="form-control" id="group_filters" name="group" value="search" onchange="form.submit()">
              <option value="" id="" disabled selected hidden>{% trans 'Select Group' %}</option>
              {% for group in group_list %}
              <option value="{{group.name}}" id="{{group.id}}" {% if group.name == selected_group %} selected {% endif %}>
                {{group.name}}</option>
              {% endfor %}
            </select>
          </div>
        </form>
        <!-- Date Picker -->
        <div class="date-picker-group">
          <form action="" method="GET" id="date_range_picker">
            <input autocomplete="off" type="text" class="form-control flatpickr flatpickr-input" name="date_range"
            placeholder="{% trans 'YYYY-MM-DD to YYYY-MM-DD' %}" id="range">
            <label for="range" class="btn-date-picker">
              <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.875 3.4375H4.125C3.7453 3.4375 3.4375 3.7453 3.4375 4.125V17.875C3.4375 18.2547 3.7453 18.5625 4.125 18.5625H17.875C18.2547 18.5625 18.5625 18.2547 18.5625 17.875V4.125C18.5625 3.7453 18.2547 3.4375 17.875 3.4375Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M15.125 2.0625V4.8125" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M6.875 2.0625V4.8125" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M3.4375 7.5625H18.5625" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>                  
              <span>{% trans 'Date' %}</span>
            </label>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Job count by types of job -->
  <div class="row row-cols-md-5 g-3 pt-3 mt-1">
    {% for job_status, job_count in jobs_count.items %}
    <div class="card-body text-center p-18px border radius-7px m-2">
      <div class="avatar avatar-md mx-auto mb-1">
        <span class="avatar-initial rounded-circle bg-label-light">
          <span>{{job_count}}</span>
        </span>
      </div>
      <span class="d-block text-nowrap text-black text-capitalize mb-0">{{job_status}}</span>
    </div>
    {% endfor %}
  </div>
  
  <!-- Jobs by date -->
  
  {% if jobs %}  
    <div id="jobs" class="job-list">
      {% if close_job == True %}
        {% regroup jobs by updated_at.date as jobs_days_group %}
      {% else %}
        {% regroup jobs by created_at.date as jobs_days_group %}
      {% endif %}
      {% for jobs_of_day in jobs_days_group %}
        <div class="date-block">
          <h5 class="fw-normal d-inline-flex align-items-center pt-2 mb-3">
            <img src="{% static 'assets/img/calendar-icon.png' %}" alt="date-icon" class="me-2">
            <span>{{jobs_of_day.grouper}}</span>
          </h5>

          <div class="row gx-2">
            {% for job in jobs_of_day.list %}
            <div class="col-xl-3 col-md-4 mb-10px single-job">
              <div class="text-center border radius-7px job-card">
                  <div class="card-body">
                  {% if job.job|media_list %}  
                  
                  <!-- Job multiple image and video carousel -->
                  <div id="carouselExampleInterval_{{job.id}}" class="carousel slide" data-bs-ride="carousel" >
                    <div class="carousel-inner radius-7px">
                      {% for image in job.job|media_list %}
                      <div class="carousel-item {% if forloop.counter0 == 0 %} active {% endif %}" onclick="window.location.href='/jobs/job-detail/{{job.id}}/'">
                      {% if image|split:'.'|last|video_list %}
                        <video class="d-block w-100" height="180" type="video/*" controls>
                          <source src="{{image}}">
                        </video>
                      {% else %}
                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdgAAAEDCAYAAACWIBV1AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAnLSURBVHgB7d0/bF3VAcfxkzZ/reCgWFVASaQi4Q4dyNAhHtqqWbN2pWvHssLUlZWVtaxZ09GVGJpIZcASrYQrQMKIUGqTOME2Tkzq85obkuA/99nv9+zc+/lIT1aen/WeY733vef+OefI0trGwwIAjNRPCgAwcgILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAFHC/TI/OJaufH5vfLvpe/K4uqDQt6FyePl/OSxMnPhdJmeOlmgL44srW08LNBxK/e/L3/9+HaZ/exu4eBceeWF8vtfni3QBwJLL7z7j/+Uua9WCwevjmLfmDlXoOscg6XzZj9ZFtdDpO6mn/10uUDXCSydZ7fw4XN9/k6BrhNYOq2OlpaczHTorG4eE69/G+gyZxHTadvFdWriaPnTZccB02pI35tbLAvL6z/6ng0fuk5g6aVXz54YRJa8eonOVoGFrrOLGAACBBYAAgQWAAIEFgACBBYAAgQWAAIEFgACBBYAAgQWAAIEFgACBBYAAgQWAAIEFgACBBYAAqzXBR22cv/7wbqrdV3W85PHy8Qx29QwLgILHbS48qBcn79d5m6tltUH3z++f/rsyfL6pSlr4cIY2JyFjlm4s17efv/LcnPh26fiWs0vrZU/z35RbizcK0CWwEKH1JHrux98/aOwPuu9DxfL/OJaAXIEFjpk7tbK4JhrG9fn7xQgR2ChQ+pu4bbqCHa3kS6wdwILHTJsMFfWBRZSBBZ6bOK4jwBI8e6CDnl16kTrx9ZLdU4d9REAKd5d0CEzF063fuzV6TMFyBFY6JDpqZPl6i/OtHrc5SFiDAzPdC4wQnVqwpuf3ysLy+tlaXVjcN/5M8fKpXMTg6iNw9XpFwdfZz+5u+VJT1demWwVYWB/BBZG5MNbK4MJHLaaPelvn94tZ08dLW/MnBvLNIU1snV3cb0UZ2H5/mb4N8rFyePl8sXTjrvCmAgsjMD1j2/vOnFDnQDinRtfjS2yNeh1N/DlAhwEm7KwT23i2mgiW6c0BLpNYGEfholro4lsPU4LdJfAwh7tJa4NkYXuE1jYg93iWhc2/8OlqR3P1q2LoIssdJfAwpDaxLWeyFRPMKpn84os9JPAwhDaxvX85PHH94ks9JPAQku7xbVeevPmb15+Kq4NkYX+EVhooU1c68i1Xnu6nTaRffv9L8uNhXsFeP4JLOxiFHFt7BbZqs4GJbLw/DOTE+zg2kdLZfazu9t+f5i4Nmpk6+NrSLfTfG8mPCF/M3fy3Fcrg7mT67/r73R+8tjgdY5jxinoKu8e2MZuI8m9xLXRhPMgI7twZ728+8HXg2tyn7p/8zhwvd1c+LbViBvYmsDCFpJxbRxkZGtc60lVW62286Tr87cHX0UWhucYLDxjHHFt1HC+fmmq7PZ6Zj9dLqNSV9hpE9dGjez1j/c2YxX0mREsPGGccW20Gcle++c3ZfX+w32PJG9sHm99b25x6J+rka27knfbGAB+YAQLjxxEXBs1sn/81c92XKt1vyPJvcb18c9v/t/stBEAPE1g6b165uw7f791YHFtvPbSxOA5EpFtE9c6On3z1y/veOawyEJ7AkuvrTyaQWl+6bttHzOOuDYunDk+8si2jWsdRTfPL7KwfwJLbzVx/WKH6QlrcOr0h+OI65PPOarIDhPXRv1dRRb2T2DppXoGbZu47ha6lFFEdvaT5aHj2mgb2WHORoa+EVh6ae7W6qGN6zCvYbvI1ukdr/3rm7KT7eLaaBPZYS/5gT4RWHjGYYjrk6/lrd/ufOLRs5Fts6TeW5u7vdtMXtFE9sIWKwQ12k5aAX0jsPCEwxTXRpuRZI3sXz787+A27Hq1bZ9fZGE4AguPTE+dPHRxbbSJbJ07uN62s5e4Nk49+lmRhfYEFjbNXDx9aOPaaBPZ7ewnro1hIru48qBA3wksvVfj+vprz8cUgHuJ7Cji2hBZaE9g6bXnKa6NYSLbTJIxirg2mshOT53Y9jF13mKRpe8Elt56HuPaaCK705nAzTHlUca18f/IvrTj8zeRfXa9WegLq+nQSzU+z2tcGzWy9VrWusLO3K2Vsri6UVbub5SLm0GtUa2/Y1qzus528zjXuAosfSWw9NLZUz8tXVFD+7tXJstB2S2y0Fd2EQP7ttusUNBHAguMhMjC0wQWGJnmmDAgsMCIXZ1+UWShCCwQILIgsECIyNJ3AgvE1Mi+dm6iQB8JLBB16tiRAn0ksAAQILAAECCwABAgsAAQILAAEGA1HXrpi7v3y8Lyejl11DZm2vzidwX6SGDptLqU21YW7qyXt9//snBwtvvbQFfYfKfT6qLjRqmHz9TE0bEsCA8HyScPnWe6vsPnIBeIh3ERWDrvyuaH+fTUicLhcOncRLny8xcKdN2RpbWNhwV64NpH35TZz5YLB6du7NQ9Cnbb0wcCS6/ML66VmwvfDs4grjfy6vHWV8+eKDMXTjvuSq8ILAAE2E8DAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwAB/wOE4TPEWphaUAAAAABJRU5ErkJggg==" data-lazysrc="{{image}}" class="d-block w-100" width="300" height="180">
                      {% endif %}
                      </div>
                      {% endfor %}
                      <div class="three-drop-button" data-id="{{job.id}}" data-address="{{job.job.address}}" data-address-info="{{job.job.address_information}}" 
                        data-group="{{job.group_id}}" data-lat="{{job.job.latitude}}" data-lng="{{job.job.longitude}}" data-img="{{job.job.job_image.first.image.url}}">
                        <button type="button" class="btn dropdown-toggle hide-arrow p-0" data-bs-toggle="dropdown" aria-expanded="false">
                          <i class="bx bx-dots-vertical-rounded"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                          {% if request.user.is_superuser or request.user.role|stringformat:"s" == "מנהל מערכת" %}
                            <li>
                              <a class="dropdown-item tranfer-job-form" data-bs-toggle="modal" data-bs-target="#edit_job_modal" id="edit_job" data-id="{{job.id}}">   
                                <div class="d-flex align-items-center">
                                  <img src="{% static 'assets/img/PencilSimple.svg' %}" class="me-2" style="width: 22px; height: 22px;" />
                                  <span>{% trans 'Edit Job' %}</span>
                                </div>
                              </a>
                            </li>
                          {% endif %}
                          {% if job.status != "סגור" and request.user.role|stringformat:"s" == "מנהל מערכת"  %}
                            <li>
                              <a class="dropdown-item tranfer-job-form" data-bs-toggle="modal" data-bs-target="#transfer_job_modal" id="transfer_job_id">
                                <div class="d-flex align-items-center">
                                  <img src="{% static 'assets/img/transfer-icon.svg' %}" class="me-2" style="width: 22px; height: 22px;" />
                                  <span>{% trans 'Transfer Job' %}</span>
                                </div>
                              </a>
                            </li>
                            <li>
                              <a class="dropdown-item d-flex align-items-center return-job-form" data-bs-toggle="modal" data-bs-target="#return_job_modal" id="return_job_options_id">
                                <div class="d-flex align-items-center">
                                  <img src="{% static 'assets/img/return-icon.svg' %}" class="me-2" style="width: 22px; height: 22px;" />
                                  <span> {% trans 'Return Job' %}</span>
                                </div>
                              </a>
                            </li>
                          {% endif %}
                          <li>
                            <a class="dropdown-item ask-about-job-form" id="ask_about_job_id" onclick="window.location.href = 
                            '/chats/?job_id={{job.id}}&group_id={{job.group_id}}&address={{job.job.address}}&description={{job.job.description}}&image= {{job.job.job_image.first.image.url}}' ">
                              <div class="d-flex align-items-center">
                                <img src="{% static 'assets/img/ask-job-icon.svg' %}" class="me-2" style="width: 22px; height: 22px;" />
                                <span>{% trans 'Ask About Job' %}</span>
                              </div>
                            </a>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  {% else %}
                  <div class="carousel-inner radius-7px">
                    <img src="{% static 'assets/img/default_job.png' %}" width=100% height="200"  
                      onclick="window.location.href = '/jobs/job-detail/{{job.id}}/' "/>
                    <div class="three-drop-button" data-id="{{job.id}}" data-address="{{job.job.address}}" data-address-info="{{job.job.address_information}}" 
                      data-group="{{job.group_id}}" data-lat="{{job.job.latitude}}" data-lng="{{job.job.longitude}}" data-img="{{job.job.job_image.first.image.url}}">
                      <button type="button" class="btn dropdown-toggle hide-arrow p-0" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bx bx-dots-vertical-rounded"></i>
                      </button>
                      <ul class="dropdown-menu dropdown-menu-end">
                        {% if request.user.is_superuser or request.user.role|stringformat:"s" == "מנהל מערכת" %}
                          <li>
                            <a class="dropdown-item tranfer-job-form" data-bs-toggle="modal" data-bs-target="#edit_job_modal" id="edit_job" data-id="{{job.id}}">   
                              <div class="d-flex align-items-center">
                                <img src="{% static 'assets/img/PencilSimple.svg' %}" class="me-2" style="width: 22px; height: 22px;" />
                                <span>{% trans 'Edit Job' %}</span>
                              </div>
                            </a>
                          </li>
                        {% endif %}
                        {% if job.status != "סגור" and request.user.role|stringformat:"s" == "מנהל מערכת" %}
                          <li>
                            <a class="dropdown-item tranfer-job-form" data-bs-toggle="modal" data-bs-target="#transfer_job_modal" id="transfer_job_id">
                              <div class="d-flex align-items-center">
                                <img src="{% static 'assets/img/transfer-icon.svg' %}" class="me-2" style="width: 22px; height: 22px;" />
                                <span>{% trans 'Transfer Job' %}</span>
                              </div>
                            </a>
                          </li>
                          <li>
                            <a class="dropdown-item d-flex align-items-center return-job-form" data-bs-toggle="modal" data-bs-target="#return_job_modal" id="return_job_options_id">
                              <div class="d-flex align-items-center">
                                <img src="{% static 'assets/img/return-icon.svg' %}" class="me-2" style="width: 22px; height: 22px;" />
                                <span> {% trans 'Return Job' %}</span>
                              </div>
                            </a>
                          </li>
                        {% endif %}
                        <li>
                          <a class="dropdown-item ask-about-job-form" id="ask_about_job_id" onclick="window.location.href = 
                          '/chats/?job_id={{job.id}}&group_id={{job.group_id}}&address={{job.job.address}}&description={{job.job.description}}&image={{job.job.job_image.first.image.url}}' ">
                            <div class="d-flex align-items-center">
                              <img src="{% static 'assets/img/ask-job-icon.svg' %}" class="me-2" style="width: 22px; height: 22px;" />
                              <span>{% trans 'Ask About Job' %}</span>
                            </div>
                          </a>
                        </li>
                      </ul>
                    </div>
                  </div>
                  {% endif %}
                  <h5 class="card-title text-start mt-2 me-2">
                    {% if job.job.priority == True %}
                      <img src="{% static 'assets/img/prority.png' %}" alt="image-icon" class="me-2">
                      <span style="color: red;">{{job.job.address}}</span>
                    {% else %}
                      <span>{{job.job.address}}</span>
                    {% endif %}
                  </h5>
                  <div class="job-info">
                    <p class="card-text mb-0 text-start">{{job.job.address_information|truncatechars:30}}</p>
                    <div class="status-block">{{job.status}}</div>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      {% endfor %}

      <!-- Jobs Pagination  -->
      <div id="pagination">
        {% include 'pagination.html' %}
      </div>
    </div>
  {% else %}
    <div class="no-data-contain">
      <img src="{% static 'assets/img/no-data-found.svg' %}" alt="no-data-found.svg">
    </div>
  {% endif %}

   <!-- Transfer-job, Duplicate Return and Wrong Return Job -->
   <div>
    {% include 'job_operations.html' %}
  </div>

  <!-- map popup -->
  <div class="modal fade create_job_modal" id="location_modal" aria-hidden="true">
    {% include 'map_popup.html' %}
  </div>

</div>

{% endblock content %}


{% block extra_js %}
<script>
  $(document).ready(function () {
    var job_type = `{{job_type}}`
    if (job_type == "Close") {
      $("#close_job_id").css({ "background-color": "#5AADDE", "color": "#FFFFFF" });
      $("#open_job_id").css({ "background-color": "#eef8fd", "color": "#19253b" });
    }else{
      $("#open_job_id").css({ "background-color": "#5AADDE", "color": "#FFFFFF" });
      $("#close_job_id").css({ "background-color": "#eef8fd", "color": "#19253b" });
    };
    
    var rangePicker = $("#range");
    rangePicker.flatpickr({
      altInput: true,
      dateFormat: "Y-m-d",
      locale: {
        firstDayOfWeek: 0,
        weekdays: {
          shorthand: ["א", "ב", "ג", "ד", "ה", "ו", "ש"],
          longhand: ["ראשון", "שני", "שלישי", "רביעי", "חמישי", "שישי", "שבת"],
        },
        months: {
          shorthand: ["ינו׳", "פבר׳", "מרץ", "אפר׳", "מאי", "יוני", "יולי", "אוג׳", "ספט׳", "אוק׳", "נוב׳", "דצמ׳"],
          longhand: ["ינואר", "פברואר", "מרץ", "אפריל", "מאי", "יוני", "יולי", "אוגוסט", "ספטמבר", "אוקטובר", "נובמבר", "דצמבר"],
        },
      },
      mode: "range",
      closeOnSelect: false,
      ariaDateFormat:"Y-m-d",
      maxDate:"today",
      defaultDate: [`{{from_date}}`, `{{to_date}}`].includes('None') ? [] : [`{{from_date}}`, `{{to_date}}`],
      onOpen: function(selectedDates, dateStr, instance) {
        $(".button-close").on("click", function() {
          instance.close();
        }
      )}
    });

    $(".flatpickr-calendar").prepend('<div class="modal-header justify-content-between mb-3"><button type="button" class="btn button-close text-reset p-0"><img src="{% static "assets/img/close-icon.svg" %}" alt="close-modal"></button><h4 class="modal-title">לוּחַ שָׁנָה</h4></div>');
    $(".flatpickr-calendar").append('<div class="btn-date-range mt-2 row px-2"><div class="col-6"><button id="btn-date-apply" class="btn-date-apply btn btn-primary">Apply</button></div><div class="col-6"><button id="job_clear_filter" class="btn-date-reset dt-button btn btn-primary">Clear</button></div></div>');

    // Clear Filter data
    $("#job_clear_filter").on("click", function(){
        var urlParams = new URLSearchParams(window.location.search);
        if(urlParams.has('date_range')||urlParams.has('group')||urlParams.has('search')){
          urlParams.delete('date_range');
          urlParams.delete('search');
          var newUrl = window.location.pathname+'?'+ urlParams.toString();
          window.location.href = newUrl
        };
      });

    var quary_parmas = new URLSearchParams(window.location.search)

    //Date Filter
    $(".btn-date-apply").click(function(){
      var group = $("#select2-group_filters-container").text();
      var date_range_value = $(".flatpickr-input").val()
      filter(date_range_value, group)
    }); 

    // Group Filter
    $('#group_filters').on("change", function(){
      var date_range_value = quary_parmas.get("date_range")
      const list = []
      var group = $("#select2-group_filters-container").text();
      filter(date_range_value, group)
    });

    // Group and Date Filter Function
    function filter(date_range_value, group){
      if (group=="Select Group"){
        const url = date_range_value ? window.location.pathname+`?job=${job_type}&date_range=${date_range_value}` : window.location.pathname+`?job=${job_type}`;
        window.location.href = url
      }else{
        const url = date_range_value ? window.location.pathname+`?job=${job_type}&date_range=${date_range_value}&group=${group.trim()}` : window.location.pathname+`?job=${job_type}&group=${group.trim()}`;
        window.location.href = url
      }
    };
    $("#save_location").on("click", function(){
      $("#edit_job_latitude").attr("value", latitude)
      $("#edit_job_longitude").attr("value", longitude)
    })

  });
</script>

{% endblock extra_js %}