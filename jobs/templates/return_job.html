{% extends 'base.html' %}
{% load static i18n %}
{% load myfilters static i18n %}

{% block extra_css %}
{{block.super}}
<style>
  #jobs{
    height: calc(100vh - 250px);
    overflow-y: auto;
    overflow-x: hidden;
  }
  
  #duplicate_notes_title{
    position: relative;
   
  }
  #duplicate_notes_title .data-edit{
    width: 100%;
    max-height: 50px;
    max-width: 120px;
    margin-left: 10px;
    padding: 7px 10px;
    position: absolute;
    top: 5px;
    left: 0;
  }
  #notes_title .data-edit{
    max-height: 50px;
    max-width: 100px;
    margin-left: 5px;
    padding: 5px 5px;
    position: absolute;
    top: 5px;
    left: 0;

  }

  #job_attachment_id {
    border: 2px solid;
    border-style: dashed;
    width: 100%;
    height: 100px;
  }

  .job-list .card {
    display: inline-block;
    white-space: normal;
  }

  #job_grouper_id {
    color: black;
    font-size: 18px;
    margin-top: 20px;
    margin-bottom: 20px;
  }

  .modal-dialog.comman_modal {
    max-width: 872px;
    width: 100%;
  }

  .flatpickr-calendar {
    max-width: 400px;
    width: 100%;
    padding: 20px;
  }
  
  .rangeMode .flatpickr-day{
    margin-bottom: 10px;
    height: 36px;
    line-height: 36px;
  }

  .job-list .date-block:first-child .fw-normal{
    padding-top: 0 !important;
  }

  .btn-date-range {
    align-items: center;
  }

  .job-modal-inner .form-group {
    overflow: inherit;
  }

  .job-modal-inner .form-group:last-child {
    margin-bottom: 0 !important;
  }

  .btn-date-range .btn {
    width: 100%;
    text-align: center;
    padding: 10px;
  }

  .flatpickr-innerContainer{
    margin-top: 10px;
  }

  .card-title{
    font-weight: 500;
    font-size: 16px;
    line-height: 25px;
    color: #19253B;
    margin: 8px 0;
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .fw-normal span{
    font-weight: 400;
    font-size: 16px;
    line-height: 24px;
    color: #32425E;
  }
  .avatar-initial span {
    margin-top: 5px;
  }

  .image-card {
    padding: 8px;
  }

  .image-card .image-block {
    border-radius: 6px;
    display: block;
    margin-bottom: 6px;
  }

  .image-card .image-block img {
    width: 100%;
    height: auto;
    object-fit: cover;
  }

  .status-block {
    padding: 2px 8px; 
    font-weight: 400;
    font-size: 13px;
    color: #5AADDE;
    background: #EEF8FD;
    border-radius: 4px;
  }

  .job-card {
    padding: 9px;
    height: 100%;
  }

  .job-info {
    display: flex;
    align-items: end;
    justify-content: space-between;
  }

  .job-info .card-text {
    font-weight: 400;
    font-size: 14px;
    line-height: 21px;
    color: #32425E;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
    
  .job-slider-section .card-body{
    border-radius: 7px !important;
  }

  .card-title{
    display: flex;
    align-items: center;
    margin-bottom: 6px;
  }

  .card-title img {
    width: 25px;
    height: 25px;
  }

  .card-title span {
    font-weight: 500;
    font-size: 16px;
    line-height: 25px;
    color: #19253B;
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .fw-normal span{
    font-weight: 400;
    font-size: 16px;
    line-height: 24px;
    color: #32425E;
  }

  .carousel-inner img,.carousel-inner video{
    width: 100%;
    height: 200px;
    object-fit: cover;
  }

  .date-picker-group{
    padding: 12px 20px;
  }

  .card-bg {
    background: #FAFAFA;
  }

  .wrong-comment,.notes-comment{
    font-weight: 400;
    font-size: 14px;
    line-height: 21px;
    word-wrap: break-word;
  }

  .alert-span{  
    font-weight: 500;
    font-size: 16px;
    line-height: 24px;
  }

  .no-data-contain {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: calc(100vh - 220px);
  }

  @media (max-width: 1440px) {
    .carousel-inner img, .carousel-inner video{
      height: 155px;
    }
  }

  #wrong_inputfile-docs {
    border: 2px dashed #ccc;
    border-radius: 7px;
    font-family: sans-serif;
    padding: 20px;
    margin-bottom: 16px;
  }
  .button {
    border-radius: 7px;
  }
  #wrong_inputfile {
    display: none;
  }

</style>

{% endblock %}

{% block content %}
<!-- Content -->
<div class="container-fluid flex-grow-1 container-p-y">

  <!-- Date Picker -->
  <div class="row">
    <div class="col-sm-6">
      <h2 class="page-title">{% trans 'Return Job List' %}</h2>
      <button class="btn" id="duplicate_return_btn" id_data="" status_data="" data-bs-toggle="modal" data-bs-target="#duplicate_return_model" hidden>
        duplicate_return_job
      </button>
      <button class="btn" id="wrong_return_btn" id_data="" status_data="" data-bs-toggle="modal" data-bs-target="#wrong_return_model" hidden>
        wrong_return_job
      </button>
    </div>
    <div class="col-sm-6 text-end">
      <div class="header-btn-group">
        <div class="date-picker-group ms-auto">
          <form action="" method="GET" id="date_range_picker">
            <input autocomplete="off" type="text" class="form-control flatpickr flatpickr-input" name="date_range" placeholder="{% trans 'YYYY-MM-DD to YYYY-MM-DD' %}" id="range" readonly="readonly">
            <label for="range" class="btn-date-picker">
              <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.875 3.4375H4.125C3.7453 3.4375 3.4375 3.7453 3.4375 4.125V17.875C3.4375 18.2547 3.7453 18.5625 4.125 18.5625H17.875C18.2547 18.5625 18.5625 18.2547 18.5625 17.875V4.125C18.5625 3.7453 18.2547 3.4375 17.875 3.4375Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M15.125 2.0625V4.8125" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M6.875 2.0625V4.8125" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M3.4375 7.5625H18.5625" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>                  
              <span>{% trans 'Date' %}</span>
            </label>
          </form>
        </div>
      </div>
    </div>
  </div>


  <!--Return Jobs List -->
  
  {% if return_jobs %}
    <div id="jobs" class="job-list">
      {% regroup return_jobs by created_at.date as jobs_days_group %}
      {% for jobs_of_day in jobs_days_group %}
      <div class="date-block">
        <h5 class="fw-normal d-inline-flex align-items-center pt-2 mb-3">
          <img src="{% static 'assets/img/calendar-icon.png' %}" alt="date-icon" class="me-2">
          <span>{{jobs_of_day.grouper}}</span>
        </h5>
        <div class="row gx-2">
          {% for job in jobs_of_day.list %}
          <div class="col-xl-3 col-md-4 mb-10px single-job">
            <div class="text-center border radius-7px job-card">
              <div class="card-body">
                  <!-- Job multiple image carousel -->
                  <div id="carouselExampleInterval_{{job.job.id}}" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner radius-7px">
                      {% if job.duplicate %}
                        {% if job.duplicate.job|media_list %}
                          {% for image in job.duplicate.job|media_list %}                      
                            <div class="carousel-item {% if forloop.counter0 == 0 %} active {% endif %}" id="carousel_image" id_data={{job.id}} status_data="{{job.status}}" data-bs-toggle="modal" data-bs-target="#duplicate_return_model">
                              {% if image|split:'.'|last|video_list %}
                                <video class="d-block w-100 rediect_return_{{job.job.id}}" width="100%" height="200" type="video/*" controls><source src="{{image}}"></video>
                              {% else %}
                                <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdgAAAEDCAYAAACWIBV1AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAnLSURBVHgB7d0/bF3VAcfxkzZ/reCgWFVASaQi4Q4dyNAhHtqqWbN2pWvHssLUlZWVtaxZ09GVGJpIZcASrYQrQMKIUGqTOME2Tkzq85obkuA/99nv9+zc+/lIT1aen/WeY733vef+OefI0trGwwIAjNRPCgAwcgILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAFHC/TI/OJaufH5vfLvpe/K4uqDQt6FyePl/OSxMnPhdJmeOlmgL44srW08LNBxK/e/L3/9+HaZ/exu4eBceeWF8vtfni3QBwJLL7z7j/+Uua9WCwevjmLfmDlXoOscg6XzZj9ZFtdDpO6mn/10uUDXCSydZ7fw4XN9/k6BrhNYOq2OlpaczHTorG4eE69/G+gyZxHTadvFdWriaPnTZccB02pI35tbLAvL6z/6ng0fuk5g6aVXz54YRJa8eonOVoGFrrOLGAACBBYAAgQWAAIEFgACBBYAAgQWAAIEFgACBBYAAgQWAAIEFgACBBYAAgQWAAIEFgACBBYAAqzXBR22cv/7wbqrdV3W85PHy8Qx29QwLgILHbS48qBcn79d5m6tltUH3z++f/rsyfL6pSlr4cIY2JyFjlm4s17efv/LcnPh26fiWs0vrZU/z35RbizcK0CWwEKH1JHrux98/aOwPuu9DxfL/OJaAXIEFjpk7tbK4JhrG9fn7xQgR2ChQ+pu4bbqCHa3kS6wdwILHTJsMFfWBRZSBBZ6bOK4jwBI8e6CDnl16kTrx9ZLdU4d9REAKd5d0CEzF063fuzV6TMFyBFY6JDpqZPl6i/OtHrc5SFiDAzPdC4wQnVqwpuf3ysLy+tlaXVjcN/5M8fKpXMTg6iNw9XpFwdfZz+5u+VJT1demWwVYWB/BBZG5MNbK4MJHLaaPelvn94tZ08dLW/MnBvLNIU1snV3cb0UZ2H5/mb4N8rFyePl8sXTjrvCmAgsjMD1j2/vOnFDnQDinRtfjS2yNeh1N/DlAhwEm7KwT23i2mgiW6c0BLpNYGEfholro4lsPU4LdJfAwh7tJa4NkYXuE1jYg93iWhc2/8OlqR3P1q2LoIssdJfAwpDaxLWeyFRPMKpn84os9JPAwhDaxvX85PHH94ks9JPAQku7xbVeevPmb15+Kq4NkYX+EVhooU1c68i1Xnu6nTaRffv9L8uNhXsFeP4JLOxiFHFt7BbZqs4GJbLw/DOTE+zg2kdLZfazu9t+f5i4Nmpk6+NrSLfTfG8mPCF/M3fy3Fcrg7mT67/r73R+8tjgdY5jxinoKu8e2MZuI8m9xLXRhPMgI7twZ728+8HXg2tyn7p/8zhwvd1c+LbViBvYmsDCFpJxbRxkZGtc60lVW62286Tr87cHX0UWhucYLDxjHHFt1HC+fmmq7PZ6Zj9dLqNSV9hpE9dGjez1j/c2YxX0mREsPGGccW20Gcle++c3ZfX+w32PJG9sHm99b25x6J+rka27knfbGAB+YAQLjxxEXBs1sn/81c92XKt1vyPJvcb18c9v/t/stBEAPE1g6b165uw7f791YHFtvPbSxOA5EpFtE9c6On3z1y/veOawyEJ7AkuvrTyaQWl+6bttHzOOuDYunDk+8si2jWsdRTfPL7KwfwJLbzVx/WKH6QlrcOr0h+OI65PPOarIDhPXRv1dRRb2T2DppXoGbZu47ha6lFFEdvaT5aHj2mgb2WHORoa+EVh6ae7W6qGN6zCvYbvI1ukdr/3rm7KT7eLaaBPZYS/5gT4RWHjGYYjrk6/lrd/ufOLRs5Fts6TeW5u7vdtMXtFE9sIWKwQ12k5aAX0jsPCEwxTXRpuRZI3sXz787+A27Hq1bZ9fZGE4AguPTE+dPHRxbbSJbJ07uN62s5e4Nk49+lmRhfYEFjbNXDx9aOPaaBPZ7ewnro1hIru48qBA3wksvVfj+vprz8cUgHuJ7Cji2hBZaE9g6bXnKa6NYSLbTJIxirg2mshOT53Y9jF13mKRpe8Elt56HuPaaCK705nAzTHlUca18f/IvrTj8zeRfXa9WegLq+nQSzU+z2tcGzWy9VrWusLO3K2Vsri6UVbub5SLm0GtUa2/Y1qzus528zjXuAosfSWw9NLZUz8tXVFD+7tXJstB2S2y0Fd2EQP7ttusUNBHAguMhMjC0wQWGJnmmDAgsMCIXZ1+UWShCCwQILIgsECIyNJ3AgvE1Mi+dm6iQB8JLBB16tiRAn0ksAAQILAAECCwABAgsAAQILAAEGA1HXrpi7v3y8Lyejl11DZm2vzidwX6SGDptLqU21YW7qyXt9//snBwtvvbQFfYfKfT6qLjRqmHz9TE0bEsCA8HyScPnWe6vsPnIBeIh3ERWDrvyuaH+fTUicLhcOncRLny8xcKdN2RpbWNhwV64NpH35TZz5YLB6du7NQ9Cnbb0wcCS6/ML66VmwvfDs4grjfy6vHWV8+eKDMXTjvuSq8ILAAE2E8DAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwAB/wOE4TPEWphaUAAAAABJRU5ErkJggg==" data-lazysrc="{{image}}" 
                                class="d-block w-100 rediect_return_{{job.job.id}}" width="100%" height="200">
                                {% endif %}
                            </div>
                          {% endfor %}
                        {% else %}
                          <div class="carousel-inner rounded-3" id="static_image" id_data={{job.id}} status_data="{{job.status}}">
                            <img class="rediect_return_{{job.job.id}}" src="{% static 'assets/img/default_job.png' %}" width="100%" height="200" data-bs-toggle="modal" data-bs-target="#duplicate_return_model" />
                          </div>
                        {% endif %}
                        
                      {% else %}
                        {% if job.job.job|media_list %}
                          {% for image in job.job.job|media_list %}
                            <div class="carousel-item {% if forloop.counter0 == 0 %} active {% endif %}" id="carousel_image" id_data={{job.id}} status_data="{{job.status}}"  data-bs-toggle="modal" data-bs-target="#wrong_return_model">
                              {% if image|split:'.'|last|video_list %}
                                <video class="d-block w-100" width="300" height="180" type="video/*" controls><source src="{{image}}"></video>
                              {% else %}
                                <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdgAAAEDCAYAAACWIBV1AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAnLSURBVHgB7d0/bF3VAcfxkzZ/reCgWFVASaQi4Q4dyNAhHtqqWbN2pWvHssLUlZWVtaxZ09GVGJpIZcASrYQrQMKIUGqTOME2Tkzq85obkuA/99nv9+zc+/lIT1aen/WeY733vef+OefI0trGwwIAjNRPCgAwcgILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAFHC/TI/OJaufH5vfLvpe/K4uqDQt6FyePl/OSxMnPhdJmeOlmgL44srW08LNBxK/e/L3/9+HaZ/exu4eBceeWF8vtfni3QBwJLL7z7j/+Uua9WCwevjmLfmDlXoOscg6XzZj9ZFtdDpO6mn/10uUDXCSydZ7fw4XN9/k6BrhNYOq2OlpaczHTorG4eE69/G+gyZxHTadvFdWriaPnTZccB02pI35tbLAvL6z/6ng0fuk5g6aVXz54YRJa8eonOVoGFrrOLGAACBBYAAgQWAAIEFgACBBYAAgQWAAIEFgACBBYAAgQWAAIEFgACBBYAAgQWAAIEFgACBBYAAqzXBR22cv/7wbqrdV3W85PHy8Qx29QwLgILHbS48qBcn79d5m6tltUH3z++f/rsyfL6pSlr4cIY2JyFjlm4s17efv/LcnPh26fiWs0vrZU/z35RbizcK0CWwEKH1JHrux98/aOwPuu9DxfL/OJaAXIEFjpk7tbK4JhrG9fn7xQgR2ChQ+pu4bbqCHa3kS6wdwILHTJsMFfWBRZSBBZ6bOK4jwBI8e6CDnl16kTrx9ZLdU4d9REAKd5d0CEzF063fuzV6TMFyBFY6JDpqZPl6i/OtHrc5SFiDAzPdC4wQnVqwpuf3ysLy+tlaXVjcN/5M8fKpXMTg6iNw9XpFwdfZz+5u+VJT1demWwVYWB/BBZG5MNbK4MJHLaaPelvn94tZ08dLW/MnBvLNIU1snV3cb0UZ2H5/mb4N8rFyePl8sXTjrvCmAgsjMD1j2/vOnFDnQDinRtfjS2yNeh1N/DlAhwEm7KwT23i2mgiW6c0BLpNYGEfholro4lsPU4LdJfAwh7tJa4NkYXuE1jYg93iWhc2/8OlqR3P1q2LoIssdJfAwpDaxLWeyFRPMKpn84os9JPAwhDaxvX85PHH94ks9JPAQku7xbVeevPmb15+Kq4NkYX+EVhooU1c68i1Xnu6nTaRffv9L8uNhXsFeP4JLOxiFHFt7BbZqs4GJbLw/DOTE+zg2kdLZfazu9t+f5i4Nmpk6+NrSLfTfG8mPCF/M3fy3Fcrg7mT67/r73R+8tjgdY5jxinoKu8e2MZuI8m9xLXRhPMgI7twZ728+8HXg2tyn7p/8zhwvd1c+LbViBvYmsDCFpJxbRxkZGtc60lVW62286Tr87cHX0UWhucYLDxjHHFt1HC+fmmq7PZ6Zj9dLqNSV9hpE9dGjez1j/c2YxX0mREsPGGccW20Gcle++c3ZfX+w32PJG9sHm99b25x6J+rka27knfbGAB+YAQLjxxEXBs1sn/81c92XKt1vyPJvcb18c9v/t/stBEAPE1g6b165uw7f791YHFtvPbSxOA5EpFtE9c6On3z1y/veOawyEJ7AkuvrTyaQWl+6bttHzOOuDYunDk+8si2jWsdRTfPL7KwfwJLbzVx/WKH6QlrcOr0h+OI65PPOarIDhPXRv1dRRb2T2DppXoGbZu47ha6lFFEdvaT5aHj2mgb2WHORoa+EVh6ae7W6qGN6zCvYbvI1ukdr/3rm7KT7eLaaBPZYS/5gT4RWHjGYYjrk6/lrd/ufOLRs5Fts6TeW5u7vdtMXtFE9sIWKwQ12k5aAX0jsPCEwxTXRpuRZI3sXz787+A27Hq1bZ9fZGE4AguPTE+dPHRxbbSJbJ07uN62s5e4Nk49+lmRhfYEFjbNXDx9aOPaaBPZ7ewnro1hIru48qBA3wksvVfj+vprz8cUgHuJ7Cji2hBZaE9g6bXnKa6NYSLbTJIxirg2mshOT53Y9jF13mKRpe8Elt56HuPaaCK705nAzTHlUca18f/IvrTj8zeRfXa9WegLq+nQSzU+z2tcGzWy9VrWusLO3K2Vsri6UVbub5SLm0GtUa2/Y1qzus528zjXuAosfSWw9NLZUz8tXVFD+7tXJstB2S2y0Fd2EQP7ttusUNBHAguMhMjC0wQWGJnmmDAgsMCIXZ1+UWShCCwQILIgsECIyNJ3AgvE1Mi+dm6iQB8JLBB16tiRAn0ksAAQILAAECCwABAgsAAQILAAEGA1HXrpi7v3y8Lyejl11DZm2vzidwX6SGDptLqU21YW7qyXt9//snBwtvvbQFfYfKfT6qLjRqmHz9TE0bEsCA8HyScPnWe6vsPnIBeIh3ERWDrvyuaH+fTUicLhcOncRLny8xcKdN2RpbWNhwV64NpH35TZz5YLB6du7NQ9Cnbb0wcCS6/ML66VmwvfDs4grjfy6vHWV8+eKDMXTjvuSq8ILAAE2E8DAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwABAgsAAQILAAECCwAB/wOE4TPEWphaUAAAAABJRU5ErkJggg==" data-lazysrc="{{image}}" 
                                class="d-block w-100 rediect_return_{{job.job.id}}" alt="" width="100%" height="250px">
                              {% endif %}
                            </div>
                          {% endfor %}
                        {% else %}
                          <div class="carousel-inner rounded-3" id="static_image" id_data={{job.id}} status_data="{{job.status}}">
                              <img class="rediect_return_{{job.job.id}}" src="{% static 'assets/img/default_job.png' %}" width="100%" height="250px" data-bs-toggle="modal" data-bs-target="#wrong_return_model" />
                          </div>
                        {% endif %}
                      {% endif %}
                      
                      <div class="three-drop-button" data-id="{{job.id}}" data-address="{{job.job.address}}">
                        <button type="button" class="btn dropdown-toggle hide-arrow p-0" data-bs-toggle="dropdown" aria-expanded="false"><i class="bx bx-dots-vertical-rounded"></i></button>
                        <ul class="dropdown-menu dropdown-menu-end">
                          <li>
                            {% if job.status == "לְשַׁכְפֵּל" %}
                              <a class="dropdown-item ask-about-job-form" id="ask_about_job_id" onclick='window.location.href="/chats/?job_id={{job.duplicate.id}}&group_id={{job.duplicate.group_id}}&address={{job.duplicate.job.address}}&description={{job.duplicate.job.description}}&image={% if job.first_job_image != None %}/media/{{job.first_job_image}}{% else %}/static/assets/img/default_job.png{% endif %}" '>
                                <div class="d-flex align-items-center">
                                  <img src="{% static 'assets/img/ask-job-icon.svg' %}" class="me-2" style="width: 22px; height: 22px;" />
                                  <span>{% trans 'Ask About Job' %}</span>
                                </div>
                              </a>
                            {% else %}
                              <a class="dropdown-item ask-about-job-form" id="ask_about_job_id" onclick='window.location.href="/chats/?job_id={{job.job.id}}&group_id={{job.job.group_id}}&address={{job.job.job.address}}&description={{job.job.job.description}}&image={% if job.first_job_image != None %}/media/{{job.first_job_image}}{% else %}/static/assets/img/default_job.png{% endif %}" '>
                                <div class="d-flex align-items-center">
                                  <img src="{% static 'assets/img/ask-job-icon.svg' %}" class="me-2" style="width: 22px; height: 22px;" />
                                  <span>{% trans 'Ask About Job' %}</span>
                                </div>
                              </a>
                            {% endif %}
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>

                {% if job.status == 'לְשַׁכְפֵּל' %}
                  <h5 class="card-title text-start mt-2 me-2">
                    {% if job.duplicate.job.priority == True %}
                      <img src="{% static 'assets/img/prority.png' %}" alt="image-icon" class="me-2">
                      <span style="color: red;">{{job.duplicate.job.address}}</span>
                    {% else %}
                      <span>{{job.duplicate.job.address}}</span>
                    {% endif %}
                  </h5>
                  <div class="job-info">
                    <p class="card-text mb-0 text-start pe-1">{{job.duplicate.job.address_information|truncatechars:30}}</p>
                    <div class="status-block">{{job.status}}</div>
                  </div>
                {% else %}
                  <h5 class="card-title text-start mt-2 me-2">
                    {% if job.job.job.priority == True %}
                      <img src="{% static 'assets/img/prority.png' %}" alt="image-icon" class="me-2">
                      <span style="color: red;">{{job.job.job.address}}</span>
                    {% else %}                   
                      <span>{{job.job.job.address}}</span>
                    {% endif %}
                  </h5>
                  <div class="job-info">
                    <p class="card-text mb-0 text-start pe-1">{{job.job.job.address_information|truncatechars:30}}</p>
                    <div class="status-block">{{job.status}}</div>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="no-data-contain">
      <img src="{% static 'assets/img/no-data-found.svg' %}" alt="no-data-found.svg">
    </div>
  {% endif %}

  <!-- Return Jobs Pagination  -->
  <div id="pagination">
    {% include 'pagination.html' %}
  </div>

  <!-- Wrong Infomation Return job modal -->
  <div class="modal fade wrong_return_model" id="wrong_return_model" data-bs-backdrop="static" data-bs-keyboard="false"
    aria-hidden="true">
    <div class="modal-dialog comman_modal modal-dialog-centered" style="width: 456px;">
      <div class="modal-content job-details-module">
        <form class="add-new-job pt-0 fv-plugins-bootstrap5 fv-plugins-framework" id="wrong_info_form_id" action=""
          method="POST">
          {% csrf_token %}
          <div class="modal-header justify-content-between">
            <h4 id="create_jobform_label" class="modal-title">{% trans 'Job Detail' %}</h4>
            <button type="reset" class="return_btn_close text-reset" data-bs-dismiss="modal" aria-label="Close" style="background-color: transparent; color: #000000; border: none;">
              <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M25 25L7 7"  stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M25 7L7 25"  stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            </button>
          </div>

          <div class="modal-body text-center add-job-model edit-form">
            <div class="header align-items-center" id="address_title">
              <h3 class="mb-0 d-inline-flex align-items-center "> 
                <img src="{% static 'assets/img/prority.png' %}" alt="image-icon" class="me-2 priority-img" id="priority_image" hidden>
                <span class="" id="wrong_title_address"></span>
              </h3>
              <h5 class="m-0" id="wrong_title_status" style="background: #EEF8FD; padding: 2px 8px; border-radius: 4px; font-weight: 400; font-size: 12px; line-height: 18px; color: #5AADDE;"></h5>
            </div>
            
            <div class="mb-3 form-group position-relative" id="notes_title">
             
                <label class="form-label" for="notes_title">
                  <h4 class="d-flex align-items-center mb-2">
                    <span class="alert-span">{% trans 'Notes' %}</span>
                  </h4>
                  <p id="notes_title_comment" class="mb-0 notes-comment"></p>
                  <p id="more_notes_title_comment" class="mb-0 notes-comment"></p>
                </label>
                  <a type="button" id="notes_read_more" hidden>{% trans 'Read more' %}</a>
                  <a type="button" id="notes_read_less" hidden>{% trans 'Read less' %}</a>
             
              <button type="button" class="btn btn-primary btn-active data-edit w-100" id="notes_btn" data-bs-toggle="modal" data-bs-target="#add_job_notes">       
                <span> {% trans 'Add Notes' %}</span>
              </button>
            </div>

            <div class="mb-3 form-group" id="wrong_comment">
              <label class="form-label" for="job_id">
                <h4 class="d-flex align-items-center mb-2">
                  <img src="{% static 'assets/img/alert.svg' %}" alt="image-icon" class="me-2">
                  <span class="alert-span">{% trans 'Job is Return ' %}</span>
                </h4>
                <p id="wrong_title_comment" class="mb-0 wrong-comment"></p>
                <p id="more_wrong_title_comment" class="mb-0 wrong-comment"></p>
              </label>
                <a type="button" id="read_more" hidden>{% trans 'Read more' %}</a>
                <a type="button" id="read_less" hidden>{% trans 'Read less' %}</a>
            </div>

            <div class="mb-3 form-group" id="wrong_return_id" hidden>
              <label class="form-label" for="wrong_return_job_id">{% trans 'ID' %}</label>
              <input autocomplete="off" type="number" class="form-control" id="wrong_return_job_id" name="id" maxlength="10" readonly value="" />
            </div>

            <div class="mb-3 form-group" id="wrong_return_staus" hidden>
              <label class="form-label" for="wrong_return_job_stauts">{% trans 'Status' %}</label>
              <input autocomplete="off" type="text" class="form-control" id="wrong_return_job_stauts" name="status" maxlength="10" readonly
                value="" />
            </div>

            <div class="mb-3 form-group" id="wrong_job_id" hidden>
              <label class="form-label" for="wrong_info_job_id">{% trans 'Job ID' %}</label>
              <input autocomplete="off" autocomplete="off" type="number" class="form-control" id="wrong_info_job_id" name="transfer_job_id" maxlength="10"
                readonly value="" />
            </div>

            <div class="mb-3 form-group">
              <label class="form-label" for="wrong_info_job_job_id">{% trans 'Job ID' %}</label>
              <input autocomplete="off" type="text" class="form-control" id="wrong_info_job_job_id" name="job__job_id" maxlength="10"
                readonly value="" />
            </div>

            <div class="form-group mb-3 w-100 d-none">
              <label class="form-label" for="wrong_job_latitude">{% trans 'Latitude' %}</label>
              <input autocomplete="off" class="map_lat_lng" type="text" id="wrong_job_latitude" name="latitude" required disabled/>
            </div>

            <div class="form-group mb-3 w-100 d-none">
              <label class="form-label" for="wrong_job_longitude">{% trans 'Longitude' %}</label>
              <input autocomplete="off" class="map_lat_lng" type="text" id="wrong_job_longitude" name="longitude" required disabled/>
            </div>

            <div class="d-flex mb-3">
              <div class="form-group mb-0 w-100" id="wrong_address_info">
                <label class="form-label" for="wrong_address_info_id" id="wrong_address_lable"></label>
                <input autocomplete="off" type="text" id="wrong_address_info_id" class="form-control" readonly value="" />
              </div>
              <div class="form-group mb-0 w-100" hidden id="edited_address">
                <label class="form-label" for="edit_wrong_address_id">{% trans 'Address' %}</label>
                <input autocomplete="off" type="text" id="edit_wrong_address_id" class="form-control" name="address" readonly value="" />
              </div>
              <button id="wrong_add-location" type="button" 
                class="location_box p-4 border-dashed rounded-3 ms-3 d-flex align-items-center btn" data-bs-toggle="modal"
                data-bs-target="#location_modal">
                <svg width="37" height="36" viewBox="0 0 37 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M8.375 32.625H28.625" stroke="#32425E" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                  <path
                    d="M18.5 19.125C20.9853 19.125 23 17.1103 23 14.625C23 12.1397 20.9853 10.125 18.5 10.125C16.0147 10.125 14 12.1397 14 14.625C14 17.1103 16.0147 19.125 18.5 19.125Z"
                    stroke="#32425E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                  <path
                    d="M29.75 14.625C29.75 24.75 18.5 32.625 18.5 32.625C18.5 32.625 7.25 24.75 7.25 14.625C7.25 11.6413 8.43526 8.77983 10.545 6.67005C12.6548 4.56026 15.5163 3.375 18.5 3.375C21.4837 3.375 24.3452 4.56026 26.455 6.67005C28.5647 8.77983 29.75 11.6413 29.75 14.625V14.625Z"
                    stroke="#32425E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
              </button>
            </div>

            <div class="form-group mb-3 w-100" hidden id="edited_address_info">
              <label class="form-label" for="edit_wrong_address_info">{% trans 'Address information' %}</label>
              <input autocomplete="off" type="text" id="edit_wrong_address_info" class="form-control" name="address_info" readonly
                value="" />
            </div>

            <div class="mb-3 form-group">
              <label class="form-label" for="wrong_description_id">{% trans 'Description' %}</label>
              <textarea autocomplete="off" id="wrong_description_id" class="form-control border-0" name="description" rows="4" cols="10" readonly></textarea>
            </div>

            <div class="image-slider owl-carousel owl-theme mb-3" id="wrong_image_carousel">
            </div>

            <div class="mb-3 form-group wrong-attchment" id="create_docs" hidden>
              <label class="form-label" for="wrong_attechment">{% trans 'Attachment' %}</label>
              <div class="row gx-3 px-2" id="wrong_attechment">
              </div>
            </div>
            


            <div id="wrong_inputfile-docs" hidden>
              <input type="file" id="wrong_inputfile" multiple
              accept=".jpg, .jpeg, .png, .mp4, .mkv, .m4a, .mov, .wmv, .avi, .avchd, .flv, .f4v, .swf, .webm, .mpeg-2, .html5, .doc, .docx, .html, .htm, .odt, .pdf, .xls, .xlsx, .ods, .ppt, .pptx, .txt, .msword, .csv, .mp3"/>
              <label class="button" for="wrong_inputfile" style="background-color: #eef8fd;">
                <h6 class="d-flex align-items-center justify-content-center p-4 mb-0 cursor-pointer">
                  <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M11 19.25C15.5563 19.25 19.25 15.5563 19.25 11C19.25 6.44365 15.5563 2.75 11 2.75C6.44365 2.75 2.75 6.44365 2.75 11C2.75 15.5563 6.44365 19.25 11 19.25Z"
                      stroke="#32425E" stroke-width="1.5" stroke-miterlimit="10" />
                    <path d="M7.5625 11H14.4375" stroke="#32425E" stroke-width="1.5" stroke-linecap="round"
                      stroke-linejoin="round" />
                    <path d="M11 7.5625V14.4375" stroke="#32425E" stroke-width="1.5" stroke-linecap="round"
                      stroke-linejoin="round" />
                  </svg>
                  <span class="ms-2">{% trans 'Add images and attachments' %} </span>
                </h6>
              </label>
            </div>

            <div class="mb-3 form-group" id="priority_id" hidden>
              <label class="form-label" for="job_priority_id">{% trans 'Priority' %}</label>
              <div class="d-flex justify-content-between align-items-center px-3 py-3">
                <label class="form-check-label" for="job_priority_id">{% trans 'Urgent Job' %}</label>
                <label class="switch_group">
                  <input type="checkbox" id="wrong_priority_id" role="switch" name="priority" disabled="True">
                  <span class="slider round"></span>
                </label>
              </div>
            </div>

            <div class="mb-0 form-group  mb-3">
              <label class="form-label" for="wrong_job_further_insp">{% trans 'Further Inspection' %}</label>
              <div class="d-flex justify-content-between align-items-center px-3 py-2">
                <label class="form-check-label font-normal text-start p-0" id="wrong_job_further_insp">{% trans 'Further Inspection' %}</label>
                <label class="switch_group" id="further_inspection_switch">
                  <input type="checkbox" id="wrong_further_insp_id" name="further_inspection" disabled="True">
                  <span class="slider round"></span>
                </label>
              </div>
            </div>

            <div class="form-group mb-3 w-100">
              <label class="form-label" for="wrong_job_latitude">{% trans 'Group' %}</label>
              <input autocomplete="off" class="map_lat_lng" type="text" id="wrong_job_group" name="group" required />
            </div>
            <div id="created_updated_closed_by2">
              
            </div>

            <div class="mb-3 form-group p-0 delete_return_docs" hidden>
              <input autocomplete="off" type="text" class="form-control" id="close_delete_image" name="image_delete" maxlength="10"/>
            </div>
          
            <div class="mb-3 form-group p-0 delete_return_docs" hidden>
              <input autocomplete="off" type="text" class="form-control" id="close_delete_docs" name="docs_delete" maxlength="10"/>
            </div>

          </div>
          <!-- Error message -->
          <div id="wrong_info_form_error" class="text-center" hidden>
            <p style="color:red; font-size: 17px; margin-top:3px;" id="form_error">
              {% trans 'Please updated the job detail then and then you can save the job.' %}
            </p>
          </div>
          
          <!-- Buttons -->
          <div class="modal-footer">
            <div class="row w-100 m-0 justify-content-center">
              <div class="col-md-6 ps-0">
                <button type="button" class="btn me-1 w-100 data-delete" data-bs-toggle="modal"
                  data-bs-target="#return_job_delete_modal" id="wrong_delete_id" data="wrong_delete">
                  <svg class="me-2" width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20.75 5.25H4.25" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                    <path d="M10.25 9.75V15.75" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                    <path d="M14.75 9.75V15.75" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                    <path d="M19.25 5.25V19.5C19.25 19.6989 19.171 19.8897 19.0303 20.0303C18.8897 20.171 18.6989 20.25 18.5 20.25H6.5C6.30109 20.25 6.11032 20.171 5.96967 20.0303C5.82902 19.8897 5.75 19.6989 5.75 19.5V5.25" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                    <path d="M16.25 5.25V3.75C16.25 3.35218 16.092 2.97064 15.8107 2.68934C15.5294 2.40804 15.1478 2.25 14.75 2.25H10.25C9.85218 2.25 9.47064 2.40804 9.18934 2.68934C8.90804 2.97064 8.75 3.35218 8.75 3.75V5.25" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                  </svg>
                  <span>{% trans 'Delete' %}</span>
                </button>
              </div>
              <div class="col-md-6 pe-0">
                <button type="button" class="btn btn-primary btn-active w-100 data-edit" id="wrong_edit_id" data="wrong_edit">
                  <svg class="me-2" width="29" height="28" viewBox="0 0 29 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10.6391 23.6249H5.75001C5.51794 23.6249 5.29538 23.5327 5.13129 23.3686C4.96719 23.2045 4.87501 22.982 4.87501 22.7499V17.8608C4.87461 17.7472 4.89662 17.6346 4.93979 17.5295C4.98295 17.4244 5.04643 17.3289 5.12657 17.2483L18.2516 4.12334C18.333 4.04067 18.43 3.97501 18.5371 3.9302C18.6441 3.88538 18.759 3.8623 18.875 3.8623C18.991 3.8623 19.1059 3.88538 19.2129 3.9302C19.32 3.97501 19.417 4.04067 19.4984 4.12334L24.3766 9.00147C24.4592 9.08288 24.5249 9.17993 24.5697 9.28696C24.6145 9.39399 24.6376 9.50887 24.6376 9.6249C24.6376 9.74094 24.6145 9.85581 24.5697 9.96284C24.5249 10.0699 24.4592 10.1669 24.3766 10.2483L11.2516 23.3733C11.171 23.4535 11.0755 23.517 10.9704 23.5601C10.8653 23.6033 10.7527 23.6253 10.6391 23.6249V23.6249Z" stroke-width="1.625" stroke-linecap="round" stroke-linejoin="round"></path>
                    <path d="M15.375 7L21.5 13.125" stroke-width="1.625" stroke-linecap="round" stroke-linejoin="round"></path>
                  </svg>
                  <span>{% trans 'Edit' %}</span>
                </button>
              </div>
              <div class="col-md-7 pe-0">
                <button type="button" class="btn btn-primary btn-active data-edit w-100" id="wrong_submit_id" hidden data="wrong_save">
                  <svg width="27" height="28" viewBox="0 0 27 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M22.7813 10.1293V22.4375C22.7813 22.6613 22.6924 22.8759 22.5341 23.0341C22.3759 23.1924 22.1613 23.2813 21.9375 23.2813H5.0625C4.83872 23.2813 4.62411 23.1924 4.46588 23.0341C4.30765 22.8759 4.21875 22.6613 4.21875 22.4375V5.56251C4.21875 5.33873 4.30765 5.12412 4.46588 4.96588C4.62411 4.80765 4.83872 4.71876 5.0625 4.71876H17.3707C17.4803 4.71837 17.5888 4.7396 17.6902 4.78122C17.7915 4.82285 17.8837 4.88405 17.9613 4.96133L22.5387 9.53868C22.616 9.61634 22.6772 9.70848 22.7188 9.80983C22.7604 9.91118 22.7816 10.0197 22.7813 10.1293V10.1293Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8.4375 23.2812V16.5312C8.4375 16.3075 8.52639 16.0929 8.68463 15.9346C8.84286 15.7764 9.05747 15.6875 9.28125 15.6875H17.7188C17.9425 15.6875 18.1571 15.7764 18.3154 15.9346C18.4736 16.0929 18.5625 16.3075 18.5625 16.5312V23.2812" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M16.0312 8.09375H10.125" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>                    
                  <span> {% trans 'Save Changes' %}</span>
                </button>
              </div>

            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Duplicate return job detail -->
  <div class="modal fade duplicate_return_model" id="duplicate_return_model" data-bs-backdrop="static"
    data-bs-keyboard="false">
    <div class="modal-dialog comman_modal return-modal modal-lg modal-dialog-centered">
      <div class="modal-content">

        <div class="modal-header justify-content-between">
          <h4 id="create_jobform_label" class="modal-title">{% trans 'Job Detail' %}</h4>
          <button type="reset" class="return_btn_close text-reset" data-bs-dismiss="modal" aria-label="Close" style="background-color: transparent; color: #000000; border: none;">
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M25 7L7 25"  stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M25 25L7 7"  stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
        </div>
        
        <div class="modal-body text-center add-job-model edit-form">
          <div class="mb-3 form-group" id="duplicate_notes_title">
            <div>
              <label class="form-label" for="duplicate_notes_title">
                <h4 class="d-flex align-items-center mb-2">
                  <span class="alert-span">{% trans 'Notes' %}</span>  
                </h4>
                <p id="duplicate_notes_title_comment" class="mb-0 notes-comment"></p>
                <p id="duplicate_more_notes_title_comment" class="mb-0 notes-comment"></p>
              </label>
                <a type="button" id="duplicate_notes_read_more" hidden>{% trans 'Read more' %}</a>
                <a type="button" id="duplicate_notes_read_less" hidden>{% trans 'Read less' %}</a>
                <button type="button" class="btn btn-primary btn-active data-edit" id="wrong_notes_btn" data-bs-toggle="modal" data-bs-target="#add_job_notes">         
                  <span> {% trans 'Add Notes' %}</span>
                </button>
            </div>
            
          </div>
          <div class="row">
            <!-- Duplicate Job -->
            <div class="col-md-6" id="duplicate_job">
              
              <div class="d-flex align-items-center justify-content-start text mb-3" id="duplicate_job_title">
                <svg class="me-1" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path
                    d="M13.125 17.5H4.375C4.20924 17.5 4.05027 17.4342 3.93306 17.3169C3.81585 17.1997 3.75 17.0408 3.75 16.875V5.625C3.75 5.45924 3.81585 5.30027 3.93306 5.18306C4.05027 5.06585 4.20924 5 4.375 5H10.625L13.75 8.125V16.875C13.75 17.0408 13.6842 17.1997 13.5669 17.3169C13.4497 17.4342 13.2908 17.5 13.125 17.5Z"
                    stroke="#666666" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                  <path
                    d="M6.25 5V3.125C6.25 2.95924 6.31585 2.80027 6.43306 2.68306C6.55027 2.56585 6.70924 2.5 6.875 2.5H13.125L16.25 5.625V14.375C16.25 14.5408 16.1842 14.6997 16.0669 14.8169C15.9497 14.9342 15.7908 15 15.625 15H13.75"
                    stroke="#666666" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                  <path d="M6.875 11.875H10.625" stroke="#666666" stroke-width="1.5" stroke-linecap="round"
                    stroke-linejoin="round" />
                  <path d="M6.875 14.375H10.625" stroke="#666666" stroke-width="1.5" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
                <p class="mb-0">{% trans 'Duplicate Job' %}</p>
              </div>

              <form class="add-new-job job-modal-inner fv-plugins-bootstrap5 fv-plugins-framework" id="duplicate_form_id" action="" method="POST" style="background: #FAFAFA;">
                {% csrf_token %}

                <div class="mb-3 form-group" id="duplicate_return_id" hidden>
                  <label class="form-label" for="return_job_id">{% trans 'ID' %}</label>
                  <input autocomplete="off" type="number" class="form-control" id="duplicate_return_job_id" name="id" maxlength="10" readonly value="" />
                </div>
      
                <div class="mb-3 form-group" id="duplicate_return_staus" hidden>
                  <label class="form-label" for="return_job_stauts">{% trans 'Status' %}</label>
                  <input autocomplete="off" type="text" class="form-control" id="duplicate_return_job_stauts" name="status" maxlength="10" readonly
                    value="" />
                </div>

                <div class="mb-3 form-group" hidden>
                  <label class="form-label" for="duplicate_job_id">{% trans 'Job ID' %}</label>
                  <input autocomplete="off" type="number" class="form-control" id="duplicate_job_id" name="duplicate_id" maxlength="10"
                    value="" disabled required />
                </div>

                <div class="mb-3 form-group">
                  <label class="form-label" for="duplicate_job_job_id">{% trans 'Job ID' %}</label>
                  <input autocomplete="off" type="text" class="form-control" id="duplicate_job_job_id" name="duplicate_job__job_id" maxlength="10"
                    value="" disabled required />
                </div>

                <div class="form-group mb-3 w-100 d-none">
                  <label class="form-label" for="duplicate_job_latitude">{% trans 'Latitude' %}</label>
                  <input autocomplete="off" class="map_lat_lng" type="text" id="duplicate_job_latitude" name="latitude" required disabled/>
                </div>

                <div class="form-group mb-3 w-100 d-none">
                  <label class="form-label" for="duplicate_job_longitude">{% trans 'Longitude' %}</label>
                  <input autocomplete="off" class="map_lat_lng" type="text" id="duplicate_job_longitude" name="longitude" required disabled/>
                </div>

                <div class="d-flex mb-3">
                  <div class="form-group mb-0 w-100" id="duplicate_address_info">
                    <label class="form-label one-line-elipsis" for="duplicate_address_info_id" id="duplicate_address_lable"></label>
                    <input autocomplete="off" type="text" id="duplicate_address_info_id" class="form-control" name="address" readonly
                      required />
                  </div>
                  <button id="duplicate_add-location" type="button" 
                    class="location_box p-4 border-dashed rounded-3 ms-3 d-flex align-items-center btn" data-bs-toggle="modal"
                    data-bs-target="#location_modal">
                    <svg width="37" height="36" viewBox="0 0 37 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M8.375 32.625H28.625" stroke="#32425E" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                      <path
                        d="M18.5 19.125C20.9853 19.125 23 17.1103 23 14.625C23 12.1397 20.9853 10.125 18.5 10.125C16.0147 10.125 14 12.1397 14 14.625C14 17.1103 16.0147 19.125 18.5 19.125Z"
                        stroke="#32425E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                      <path
                        d="M29.75 14.625C29.75 24.75 18.5 32.625 18.5 32.625C18.5 32.625 7.25 24.75 7.25 14.625C7.25 11.6413 8.43526 8.77983 10.545 6.67005C12.6548 4.56026 15.5163 3.375 18.5 3.375C21.4837 3.375 24.3452 4.56026 26.455 6.67005C28.5647 8.77983 29.75 11.6413 29.75 14.625V14.625Z"
                        stroke="#32425E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                  </button>
                </div>

                <div class="image-slider owl-carousel owl-theme" id="duplicate_image_carousel">
                </div>
              </form>
            </div>

            <!-- Original Job -->
            <div class="col-md-6" id="original_job">
              <div class="d-flex align-items-center justify-content-start text mb-3">
                <svg class="me-1" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path
                    d="M15.125 15.5H6.375C6.20924 15.5 6.05027 15.4342 5.93306 15.3169C5.81585 15.1997 5.75 15.0408 5.75 14.875V3.625C5.75 3.45924 5.81585 3.30027 5.93306 3.18306C6.05027 3.06585 6.20924 3 6.375 3H12.625L15.75 6.125V14.875C15.75 15.0408 15.6842 15.1997 15.5669 15.3169C15.4497 15.4342 15.2908 15.5 15.125 15.5Z"
                    stroke="#666666" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                  <path d="M8.875 9.875H12.625" stroke="#666666" stroke-width="1.5" stroke-linecap="round"
                    stroke-linejoin="round" />
                  <path d="M8.875 12.375H12.625" stroke="#666666" stroke-width="1.5" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
                <p class="mb-0">{% trans 'Original Job' %}</p>
              </div>
              <div class="job-modal-inner">
                <div class="mb-3 form-group" hidden>
                  <label class="form-label" for="original_job_id">{% trans 'Job ID' %}</label>
                  <input autocomplete="off" type="number" class="form-control" id="original_job_id" name="original_id" maxlength="10" readonly required />
                </div>

                <div class="mb-3 form-group">
                  <label class="form-label" for="original_job_job_id">{% trans 'Job ID' %}</label>
                  <input autocomplete="off" type="text" class="form-control" id="original_job_job_id" name="original_id" maxlength="10" readonly required />
                </div>

                <div class="form-group mb-3 w-100 d-none">
                  <label class="form-label" for="original_job_latitude">{% trans 'Latitude' %}</label>
                  <input autocomplete="off" class="map_lat_lng" type="text" id="original_job_latitude" name="latitude" disabled required/>
                </div>

                <div class="form-group mb-3 w-100 d-none">
                  <label class="form-label" for="original_job_longitude">{% trans 'Longitude' %}</label>
                  <input autocomplete="off" class="map_lat_lng" type="text" id="original_job_longitude" name="longitude" disabled required/>
                </div>

                <div class="d-flex mb-3">
                  <div class="form-group mb-0 w-100">
                    <label class="form-label one-line-elipsis" for="original_address_info_id" id="original_address_lable">{% trans 'Address' %}</label>
                    <input autocomplete="off" type="text" id="original_address_info_id" class="form-control" name="address" required 
                      readonly />
                  </div>
                  <button id="original_add-location" type="button" 
                    class="location_box p-4 border-dashed rounded-3 ms-3 d-flex align-items-center btn" data-bs-toggle="modal"
                    data-bs-target="#location_modal">
                    <svg width="37" height="36" viewBox="0 0 37 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M8.375 32.625H28.625" stroke="#32425E" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                      <path
                        d="M18.5 19.125C20.9853 19.125 23 17.1103 23 14.625C23 12.1397 20.9853 10.125 18.5 10.125C16.0147 10.125 14 12.1397 14 14.625C14 17.1103 16.0147 19.125 18.5 19.125Z"
                        stroke="#32425E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                      <path
                        d="M29.75 14.625C29.75 24.75 18.5 32.625 18.5 32.625C18.5 32.625 7.25 24.75 7.25 14.625C7.25 11.6413 8.43526 8.77983 10.545 6.67005C12.6548 4.56026 15.5163 3.375 18.5 3.375C21.4837 3.375 24.3452 4.56026 26.455 6.67005C28.5647 8.77983 29.75 11.6413 29.75 14.625V14.625Z"
                        stroke="#32425E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                  </button>
                </div>

                <div class="image-slider owl-carousel owl-theme" id="original_image_carousel">
                </div>
              </div>
              <!-- Error message -->
              <div id="duplicate_form_error" class="text-center" hidden><p style="color:red; font-size: 17px; margin-top:3px;" id="form_error">{% trans 'Please updated the job detail then and then you can save the job.' %}</p></div>
            </div>
          </div> 
        </div> 
        <!-- Buttons -->
        <div class="modal-footer">
          <div class="col-10 mx-auto my-0">
            <div class="row w-100 mx-0">
              <div class="col-6">
                <button type="button" class="btn w-100" id="duplicate_submit_id" data="duplicate_save">
                  <svg class="me-2" width="29" height="28" viewBox="0 0 29 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10.6391 23.6249H5.75001C5.51794 23.6249 5.29538 23.5327 5.13129 23.3686C4.96719 23.2045 4.87501 22.982 4.87501 22.7499V17.8608C4.87461 17.7472 4.89662 17.6346 4.93979 17.5295C4.98295 17.4244 5.04643 17.3289 5.12657 17.2483L18.2516 4.12334C18.333 4.04067 18.43 3.97501 18.5371 3.9302C18.6441 3.88538 18.759 3.8623 18.875 3.8623C18.991 3.8623 19.1059 3.88538 19.2129 3.9302C19.32 3.97501 19.417 4.04067 19.4984 4.12334L24.3766 9.00147C24.4592 9.08288 24.5249 9.17993 24.5697 9.28696C24.6145 9.39399 24.6376 9.50887 24.6376 9.6249C24.6376 9.74094 24.6145 9.85581 24.5697 9.96284C24.5249 10.0699 24.4592 10.1669 24.3766 10.2483L11.2516 23.3733C11.171 23.4535 11.0755 23.517 10.9704 23.5601C10.8653 23.6033 10.7527 23.6253 10.6391 23.6249V23.6249Z" stroke-width="1.625" stroke-linecap="round" stroke-linejoin="round"></path>
                    <path d="M15.375 7L21.5 13.125" stroke-width="1.625" stroke-linecap="round" stroke-linejoin="round"></path>
                  </svg>
                  <span>{% trans 'Not Approved' %}</span>
                </button>
              </div>
              <div class="col-6">
                <button type="submit" class="btn w-100 btn-active" id="duplicate_confirm_id" data="duplicate_confirm">
                  <svg class="me-1" width="29" height="30" viewBox="0 0 29 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19.4844 12.2812L12.8348 18.625L9.51562 15.4531" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M14.5 25.875C20.5061 25.875 25.375 21.0061 25.375 15C25.375 8.9939 20.5061 4.125 14.5 4.125C8.4939 4.125 3.625 8.9939 3.625 15C3.625 21.0061 8.4939 25.875 14.5 25.875Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>                                
                  <span>{% trans 'Confirm Duplicate' %}</span>
                </button>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Retur job delete modal -->
  <div class="modal fade return_job_delete_modal" id="return_job_delete_modal" tabindex="-1" data-bs-backdrop="static"
    data-bs-keyboard="false" aria-labelledby="delete_bill_modalLabel" aria-hidden="true">
    <div class="modal-dialog comman_modal modal-dialog-centered" style="max-width: 468px;">
      {% include 'return_job_delete.html' %}
    </div>
  </div>

  <!-- Map modal-->
  <div class="modal fade create_job_modal" id="location_modal" aria-hidden="true">
    {% include 'map_popup.html' %}
  </div>

  <!-- Add Notes modal-->
  <div class="modal fade add_job_notes" id="add_job_notes" tabindex="-1" data-bs-backdrop="static"
    data-bs-keyboard="false" aria-labelledby="delete_bill_modalLabel" aria-hidden="true">
    <div class="modal-dialog comman_modal modal-dialog-centered" style="max-width: 468px;">
      {% include 'add_return_job_notes.html' %}
    </div>
  </div>

<!-- / Content -->
{% endblock %}

{% block extra_js %}
<script>

  function return_doc_remove(id, carousel_name){
    var attachment;
    if(carousel_name){
      attachment = "image"
      var deleted_img_id = $("#close_delete_image").attr("value") +","+ id
      $("#close_delete_image").attr("value", deleted_img_id.replace('undefined,', ''))
    }else{
      var deleted_docs_id = $("#close_delete_docs").attr("value") +","+ id
      $("#close_delete_docs").attr("value", deleted_docs_id.replace('undefined,', ''))
    }
    

    if(carousel_name){
      var owl = $(`#${carousel_name}.owl-carousel`);
      var activeItem = $(`#${carousel_name}.owl-carousel .owl-item.active`);
      var indexToRemove = activeItem.index();
      owl.trigger('remove.owl.carousel', indexToRemove).trigger('refresh.owl.carousel');
    }else{
      $(`#remove_document_${id}`).remove()
      if($(`.edit_docuemnt`).length == 0){
        $(".wrong-attchment").hide()
      }
    }
  }  

  $(document).ready(function () {

    $("#notes_btn, #wrong_notes_btn").on("click", function(){
      var job_id = $(this).attr("job_id")
      if($(this).attr("id") == "wrong_notes_btn"){
        $("#close_notes_popup").attr("data-bs-target", "#duplicate_return_model")
      }else{
        $("#close_notes_popup").attr("data-bs-target", "#wrong_return_model")
      }
      $("#return_job_notes").attr("action", `/jobs/return_job_notes/${parseInt(job_id)}/`)
    })
    
    $("#range").flatpickr({
      altInput: true,
      dateFormat: "Y-m-d",
      locale: {
        firstDayOfWeek: 0,
        weekdays: {
          shorthand: ["א", "ב", "ג", "ד", "ה", "ו", "ש"],
          longhand: ["ראשון", "שני", "שלישי", "רביעי", "חמישי", "שישי", "שבת"],
        },
        months: {
          shorthand: ["ינו׳", "פבר׳", "מרץ", "אפר׳", "מאי", "יוני", "יולי", "אוג׳", "ספט׳", "אוק׳", "נוב׳", "דצמ׳"],
          longhand: ["ינואר", "פברואר", "מרץ", "אפריל", "מאי", "יוני", "יולי", "אוגוסט", "ספטמבר", "אוקטובר", "נובמבר", "דצמבר"],
        },
      },
      mode: "range",
      closeOnSelect: false,
      ariaDateFormat:"Y-m-d",
      maxDate:"today",
      defaultDate: [`{{from_date}}`, `{{to_date}}`].includes('None') ? [] : [`{{from_date}}`, `{{to_date}}`],
      onOpen: function(selectedDates, dateStr, instance) {
        $(".button-close").on("click", function() {
          instance.close();
        }
      )}
    });
    
    $(".flatpickr-calendar").prepend('<div class="modal-header justify-content-between mb-3"><button type="button" class="btn button-close text-reset p-0"><img src="{% static "assets/img/close-icon.svg" %}" alt="close-modal"></button><h4 class="modal-title">לוּחַ שָׁנָה</h4></div>');
    $(".flatpickr-calendar").append('<div class="btn-date-range mt-2 row px-2"><div class="col-6"><button id="btn-date-apply" class="btn-date-apply btn btn-primary">Apply</button></div><div class="col-6"><button id="clear_filter" class="btn-date-reset dt-button btn btn-primary">Clear</button></div></div>');

    $(".btn-date-apply").click(function(){
      $("#date_range_picker").submit();
    }); 
    
    $("#clear_filter").on("click", function(){
      var urlParams = new URLSearchParams(window.location.search);
      if(urlParams.has('date_range')|urlParams.has('group')){
      urlParams.delete('date_range');
      urlParams.delete('group');
      urlParams.delete('groups');
      var newUrl = window.location.pathname + urlParams.toString();
      window.location.href = newUrl
      };
    });

    //filtering by job id and job address or any other text in searchbox
    $("#global_job_search_id").on("keyup", function () {
      var filter = $(this).val();
      $(".added-job-list .date-block .single-job").each(function () {
        // If the job item does not contain the text phrase, hide job
        if ($(this).text().search(new RegExp(filter, "i")) < 0) {
          $(this).hide();
          // Show the job item if the text matches
        } else {
          $(this).show();
        }
      });
    });

    //onclick job - ajax call
    $("#static_image, #carousel_image, #wrong_return_btn").on("click", function () {
      job_id = $(this).attr("id_data")
      job_status = $(this).attr("status_data")
      call_ajax(job_id, job_status)
    });
    var appendedLogData = {
      is_visited: false
};
var translations = {
    Job_created_by: "{% trans 'Job Added By' %}",
    Job_created_on: "{% trans 'The Job Added on' %}",
    Job_updated_by: "{% trans 'Job Updated By' %}",
    Job_closed_by: "{% trans 'Job Closed By' %}",
    Job_returned_by: "{% trans 'Job Returned By' %}",
    Job_partially_closed_by: "{% trans 'Job Partial Closed By' %}",
    Job_transferred_by: "{% trans 'Job Transferred By' %}",
    Job_updated_on: "{% trans 'The Job Updated on' %}",
    Job_closed_on: "{% trans 'The Job Closed on' %}",
    Job_returned_on: "{% trans 'The Job Returned on' %}",
    Job_partially_closed_on: "{% trans 'The Job Partial Closed on' %}",
    Job_transferred_on: "{% trans 'The Job Transferred on' %}"
  };
function appendLogData(data){
  var jobLogsData = data.job_logs_data;
              jobLogsData.forEach(function (logData) {
              var name = logData["user_name"] == "" ? logData["email"].split("@")[0] : logData["user_name"];
              var phone = logData["phone"].replace(/^\+972|[^0-9]/g, '');
              var log_date = format_date(logData["created_at"]);
              var label = translations[logData['label']];
              var label2 = translations[logData['label2']];
              $("#created_updated_closed_by2").append(`
            <div class="mb-3 job_added_by_id border border-1 rounded-3">
                <label class="form-label" for="job_added_by_id">${label}</label>
                <div class="job-inner-card">
                    <div class="job-row remove-edit" id="${label.replace(' ', '_').toLowerCase()}">
                        <img src="${logData["profile_image"]}" style="width:50px; height:50px; border-radius:5px;object-fit: cover;">
                        <div class="group-block">
                            <h6>${name}</h6>
                            <p class="m-0">${logData["role"]}</p>
                            <p class="m-0">${phone}</p>
                        </div>
                    </div>
                    <p class="status-time">{% trans '${label2}' %} <br /> ${log_date}</p>
                </div>
            </div>
        `);
                });
}
function format_date(input_date){
    const parts = input_date.split('-');
    const date = new Date(parts[0], parts[1] - 1, parts[2]);
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    const formattedDate = new Intl.DateTimeFormat('he-IL', options).format(date);
    return formattedDate
  }
    function call_ajax(job_id, job_status){
      $.ajax({
        url: `/jobs/return-job-detail/?job_id=${job_id}&job_status=${job_status}`,
        type: "GET",
        dataType: "json",
        success: function (response) {
          if (response.data["status"] == "לְשַׁכְפֵּל") {
            appendtoduplicate(response.data)
          }
          else if (response.data["status"] == "מידע שגוי") {
            appendtowrongjob(response.data)
          }
        }
      });
    }

    //Append ajax data in duplicate and original job model
    var duplicate_latitude, duplicate_longitude, original_latitude, original_longitude, wrong_latitude, wrong_longitude, map_readonly=true
    function appendtoduplicate(data) {
      $("#duplicate_return_job_id").attr("value", data.id)
      $("#wrong_notes_btn").attr("job_id", data.id)
      $("#notes").html(data.notes)
      $("#duplicate_return_job_stauts").attr("value", data.status)
      $("#duplicate_job_id").attr("value", data.duplicate_job_id)
      $("#duplicate_job_job_id").attr("value", data.duplicate_job_job_id)
      $("#duplicate_address_lable").text(data.duplicate_address)
      $("#duplicate_address_info_id").attr("value", data.duplicate_address_information)
      $("#original_job_id").attr("value", data.job_id)
      $("#original_job_job_id").attr("value", data.job_job_id)
      $("#original_address_lable").text(data.address)
      $("#original_address_info_id").attr("value", data.address_information)

      $("#duplicate_job_latitude").attr("value", data.duplicate_latitude)
      $("#duplicate_job_longitude").attr("value", data.duplicate_longitude)
      $("#original_job_latitude").attr("value", data.latitude)
      $("#original_job_longitude").attr("value", data.longitude)
      if (data.job_logs_data) {
        if (appendedLogData['is_visited']) return;
                appendLogData(data)
                appendedLogData['is_visited'] = true; 
              }

      if(data.notes){
          const notes_paragraph = data.notes
          const notes_words_array = notes_paragraph.split(" ")
          const notes_words = notes_words_array.slice(0, 30).join(" ");
    
          if(notes_words_array.length>30){
            $("#duplicate_notes_title_comment").text(`${notes_words}...`)
            $("#duplicate_more_notes_title_comment").text(data.notes)
            $("#duplicate_more_notes_title_comment").hide()
            $("#duplicate_notes_read_more").attr("hidden", false);
          }else{
            $("#duplicate_notes_title_comment").text(data.notes)
          }
      }

      $("#duplicate_notes_read_more").on("click", function(){
        $("#duplicate_notes_read_more").attr("hidden", true);
        $("#duplicate_notes_read_less").attr("hidden", false);
        $("#duplicate_notes_title_comment").hide()
        $("#duplicate_more_notes_title_comment").show()
      });
  
      $("#duplicate_notes_read_less").on("click", function(){
        $("#duplicate_notes_read_less").attr("hidden", true);
        $("#duplicate_notes_read_more").attr("hidden", false);
        $("#duplicate_notes_title_comment").show()
        $("#duplicate_more_notes_title_comment").hide()
      });
      

      duplicate_latitude = data.duplicate_latitude
      duplicate_longitude = data.duplicate_longitude
      original_latitude = data.latitude
      original_longitude = data.longitude

      var dulicate_image = data.duplicata_image
      if(dulicate_image.length===0){
        $("#duplicate_image_carousel.owl-carousel").owlCarousel("add", ('<div class="item"><img src="{% static "assets/img/default_job.png" id="default_carousel_img" %}"></div>'));
      }
      for (var i = 0; i < dulicate_image.length; i++) {
        var dulicate_image_array = dulicate_image[i].split(".")
        var image_extension = dulicate_image_array[dulicate_image_array.length-1]
        if(image_extension=="jpeg"||image_extension=="png"||image_extension=="jpg"){
          $("#duplicate_image_carousel.owl-carousel").owlCarousel("add", (`
            <div class="item">
              <a data-magnify="gallery" data-src="" data-group="a" href="${dulicate_image[i]}" class="test">
                <img src="${dulicate_image[i]}">
              </a>
            </div>
          `));
        }else{
          $("#duplicate_image_carousel.owl-carousel").owlCarousel("add", ('<div class="item"><video src="' + dulicate_image[i] + '" controls></video></div>'));
        }
      }
      $(".owl-carousel").owlCarousel("update");

      var original_image = data.image
      if(original_image.length===0){
        $("#original_image_carousel.owl-carousel").owlCarousel("add", ('<div class="item"><img src="{% static "assets/img/default_job.png" id="default_carousel_img" %}"></div>'));
      }
      for (var i = 0; i < original_image.length; i++) {
        var original_image_array = original_image[i]["img_url"].split(".")
        var image_extension = original_image_array[original_image_array.length-1]
        if(image_extension=="jpeg"||image_extension=="png"||image_extension=="jpg"){
          $("#original_image_carousel.owl-carousel").owlCarousel("add", (`
            <div class="item">
              <a data-magnify="gallery" data-src="" data-group="a" href="${original_image[i]["img_url"]}" class="test">
                <img src="${original_image[i]["img_url"]}">
              </a>
            </div>
          `));
        }else{
          $("#original_image_carousel.owl-carousel").owlCarousel("add", ('<div class="item"><video src="' + original_image[i]["img_url"] + '" controls></video></div>'));
        }
      }
      $(".owl-carousel").owlCarousel("update");

      // Magnific-popup
      $("[data-magnify=gallery]").magnify({
        draggable: false,
        resizable: false,
        movable: false,
        title: true,
        modalWidth: 1109,
        modalHeight: 607,
        initEvent: 'click',
        fixedContent:true,
        title:true,
        zIndex: 1090,
        keyboard: true,
        progressiveLoading: true,
        headToolbar: ['close'],
        footToolbar: ['zoomIn', 'zoomOut', 'prev', 'next'],
        icons: {
          prev: '<svg width="12" height="22" viewBox="0 0 12 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1.3125 20.375L10.6875 11L1.3125 1.625" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>',              
          next: '<svg width="12" height="22" viewBox="0 0 12 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.6875 20.375L1.3125 11L10.6875 1.625" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>',              
          close: '<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M25 7L7 25" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M25 25L7 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',              
          zoomIn:'<svg width="38" height="38" viewBox="0 0 38 38" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.5664 18.5254H22.4831" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M18.5249 22.4836V14.5669" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M18.2082 33.2498C26.5155 33.2498 33.2498 26.5155 33.2498 18.2082C33.2498 9.90089 26.5155 3.1665 18.2082 3.1665C9.90089 3.1665 3.1665 9.90089 3.1665 18.2082C3.1665 26.5155 9.90089 33.2498 18.2082 33.2498Z" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M34.8332 34.8332L31.6665 31.6665" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>',
          zoomOut:'<svg width="38" height="38" viewBox="0 0 38 38" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.25 18.5249H22.1667" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M18.2082 33.2498C26.5155 33.2498 33.2498 26.5155 33.2498 18.2082C33.2498 9.90089 26.5155 3.1665 18.2082 3.1665C9.90089 3.1665 3.1665 9.90089 3.1665 18.2082C3.1665 26.5155 9.90089 33.2498 18.2082 33.2498Z" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M34.8332 34.8332L31.6665 31.6665" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>',
        }, 
        callbacks: {
          opened: function(el){
            var img_url=$(".owl-item.active a").attr("href")
            var img_name = img_url.split('/').pop()
            $(".magnify-head-toolbar").append(`<a href="${img_url}" id="img_preview_download" download target="_blank"><img src="{% static "assets/img/download_icon.svg" %}" alt="download-icon" /></a>`);
            $(".magnify-header").append(`<div class="title_block"><div class="icon_logo"><img src="{% static "assets/img/image_icon.svg" %}" alt="image-icon" /></div><div class="image_title"><p class="image-title" id="img_preview_title">${img_name}</p><span class="image_size" id="img_preview_size"></span></div></div>`);
            var url = `${img_url}`;
            get_size(url)
          },
          changed: function(el){
            var img_url = $(".magnify-image").attr("src")
            var img = document.getElementsByClassName("magnify-image")
            var img_name = img_url.split('/').pop()
            $("#img_preview_download").attr("href", img_url);
            $("#img_preview_title").text(img_name);
            var url = `${img_url}`;
            get_size(url)
          } 
        },
      });
      function get_size(url){
        fetch(url)
        .then(response => {
          const contentLength = response.headers.get('Content-Length');
          const fileSizeInBytes = contentLength;
          if(fileSizeInBytes.length>6){
            $("#img_preview_size").text(`${(contentLength/(1024*1024)).toFixed(2)} MB`)
          }else(
            $("#img_preview_size").text(`${(contentLength/1024).toFixed(2)} KB`)
          )
        });
      };

    };


    //Append ajax data in wrong information job model
    function appendtowrongjob(data) {
      $("#wrong_title_address").text(data.address)
      $("#wrong_title_status").text(data.job_status)
      $("#wrong_return_job_id").attr("value", data.id)
      $("#notes_btn").attr("job_id", data.id)
      $("#notes").html(data.notes)
      $("#wrong_return_job_stauts").attr("value", data.status)
      $("#wrong_info_job_id").attr("value", data.job_id)
      $("#wrong_info_job_job_id").attr("value", data.job_job_id)
      $("#wrong_address_lable").text(data.address)
      $("#edit_wrong_address_id").attr("value", data.address)
      $("#wrong_address_info_id").attr("value", data.address_information)
      $("#edit_wrong_address_info").attr("value", data.address_information)
      $("#wrong_description_id").text(data.description)

      if (data.job_logs_data) {
        if (appendedLogData['is_visited']) return;
                appendLogData(data)
                appendedLogData['is_visited'] = true; 
              }
      $("#wrong_job_group").attr("value", data.group)

      $("#notes_read_more, #read_more, #notes_read_less, #read_less").attr("hidden", true)
      
      const paragraph = data.comment
      const words_array = paragraph.split(" ")
      const words = words_array.slice(0, 20).join(" ");

      if(words_array.length>20){
        $("#wrong_title_comment").text(`${words}...`)
        $("#more_wrong_title_comment").text(data.comment)
        $("#more_wrong_title_comment").hide()
        $("#read_more").attr("hidden", false);
      }else{
        $("#wrong_title_comment").text(data.comment)
      }
      
      $("#more_notes_title_comment").text("")
      $("#notes_title_comment").text("")
      if(data.notes){
          const notes_paragraph = data.notes
          const notes_words_array = notes_paragraph.split(" ")
          const notes_words = notes_words_array.slice(0, 20).join(" ");
    
          if(notes_words_array.length>20){
            $("#notes_title_comment").text(`${notes_words}...`)
            $("#more_notes_title_comment").text(data.notes)
            $("#more_notes_title_comment").hide()
            $("#notes_read_more").attr("hidden", false);
          }else{
            $("#notes_title_comment").text(data.notes)
          }
      }

      const date = new Date(data.created_at);
      var options = { day: 'numeric', month: 'short', year: 'numeric' };
      var formattedDate = date.toLocaleString('en-US', options);
      $("#job_created_date").text(formattedDate)

      var myDiv = document.getElementById("wrong_title_address");
      myDiv.style.color = "black";
      $("#priority_image").attr("hidden", true)
      if (data.priority===true){
        $("#priority_image").attr("hidden", false)
        myDiv.style.color = "red";
      }

      $("#wrong_priority_id").attr("checked", data.priority)
      $("#wrong_further_insp_id").attr("checked", data.further_inspection)
      var further_inspection_status = data.further_inspection==true ? "{% trans 'Yes' %}" : "{% trans 'No' %}"
      $("#wrong_job_further_insp").text(further_inspection_status)
      $("#further_inspection_switch").hide()

      $("#wrong_job_latitude").attr("value", data.latitude)
      $("#wrong_job_longitude").attr("value", data.longitude)

      wrong_latitude = data.latitude
      wrong_longitude = data.longitude

      var image = data.image
      for (var i = 0; i < image.length; i++) {
        var image_array = image[i]["img_url"].split(".")
        var image_extension = image_array[image_array.length-1]

        if(image_extension=="jpeg"||image_extension=="png"||image_extension=="jpg"){
          $("#wrong_image_carousel.owl-carousel").owlCarousel("add", (`
            <button class="owl_image_remove close-icon" type="button" 
              onclick="return_doc_remove('${image[i]["img_id"]}', 'wrong_image_carousel')">
              <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M25 7L7 25" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M25 25L7 7"  stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            </button>
            <div class="item"><img src="${image[i]["img_url"]}"></div>
          `));
        }else{
          $("#wrong_image_carousel.owl-carousel").owlCarousel("add", (`
            <button class="owl_image_remove close-icon" type="button" 
              onclick="return_doc_remove('${image[i]["img_id"]}', 'wrong_image_carousel')">
              <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M25 7L7 25" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M25 25L7 7"  stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            </button>
            <div class="item"><video src="${image[i]["img_url"]} " controls></video></div>
          `));
        }
      }
      $(".owl-carousel").owlCarousel("update");

      var attechment = data.attachement
      if(attechment.length!==0){
        $(".wrong-attchment").attr("hidden", false)
      }
      for (var i = 0; i < attechment.length; i++) {
        var name = attechment[i]
        $("#wrong_attechment").append(`
        <div class="col-sm-6 position-relative edit_docuemnt" id="remove_document_${name[3]}">
          <button class="remove_docs close-icon small-icon" type="button" 
              onclick="return_doc_remove('${name[3]}')">
              <svg width="32" height="32" viewBox="0 0 32 32" stroke="#000000" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M25 7L7 25" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                  <path d="M25 25L7 7"  stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
          </button>
          <div class="document_block">
            <div class="document_name">${name[0]}</div>
            <div class="document_info">
              <p>${name[1]}</p>
              <span>12 MB</span>
            </div>
          </div>
        </div>
        `)
      }
    };

    $("#read_more").on("click", function(){
      $("#read_more").attr("hidden", true);
      $("#read_less").attr("hidden", false);
      $("#wrong_title_comment").hide()
      $("#more_wrong_title_comment").show()
    });

    $("#read_less").on("click", function(){
      $("#read_less").attr("hidden", true);
      $("#read_more").attr("hidden", false);
      $("#wrong_title_comment").show()
      $("#more_wrong_title_comment").hide()
    });

    $("#notes_read_more").on("click", function(){
      $("#notes_read_more").attr("hidden", true);
      $("#notes_read_less").attr("hidden", false);
      $("#notes_title_comment").hide()
      $("#more_notes_title_comment").show()
    });

    $("#notes_read_less").on("click", function(){
      $("#notes_read_less").attr("hidden", true);
      $("#notes_read_more").attr("hidden", false);
      $("#notes_title_comment").show()
      $("#more_notes_title_comment").hide()
    });

    var updateData, updateData_lenght;
    $("#wrong_edit_id").on("click", function () {
      $("#wrong_info_form_id").find("*").not("#wrong_info_job_id, #wrong_return_id, #wrong_return_staus, #wrong_info_form_error, #wrong_job_id, .delete_return_docs").removeAttr('readonly').removeAttr('hidden').attr('disabled', false);
      $("#job_creator, #wrong_comment, #address_title, #wrong_delete_id, #wrong_edit_id, #notes_title").attr('hidden',true);
      $("#further_inspection_switch").show();
      $("#notes_title").hide();
      $("#wrong_job_further_insp").text("{% trans 'Further Inspection' %}");
      $("#save_location, #live_location").removeAttr('hidden');
      $("#wrong_submit_id, #edited_address, #edited_address_info").show()
      $("#wrong_address_info").hide();
      updateData = new FormData(document.querySelector("#wrong_info_form_id"))
      updateData_lenght = Array.from(updateData.entries()).length
      map_readonly=false
      if($('#wrong_attechment').find('.document_block').length===0){
        $('#create_docs').attr("hidden", true)
      }
    });
    //Update retrun job and close return job ajax call
    $("#duplicate_confirm_id, #duplicate_submit_id, #wrong_submit_id").on("click", function(){
      
      var btn_data=$(this).attr("data")
      formData = new FormData(document.querySelector("#duplicate_form_id"))
      let csrfmiddlewaretoken = $("#duplicate_form_id").children().first().val()

      if(btn_data=="duplicate_confirm"){
        var data=$("#duplicate_return_job_stauts").attr("value")
        url = `/jobs/return_job_update/?data=${data}`
      }
      else if(btn_data=="duplicate_save"){
        url = `/jobs/return_job_update/?data=${btn_data}`
      }
      else if(btn_data=="wrong_save"){
        url = `/jobs/return_job_update/?data=${btn_data}`
        formData = new FormData(document.querySelector("#wrong_info_form_id"))
        let csrfmiddlewaretoken = $("#wrong_info_form_id").children().first().val()
      }

      var isDifferent;
      formData_length = Array.from(formData.entries()).length

      if(btn_data=="wrong_save"){
        isDifferent = false;
        for(const [key, value] of formData.entries()){
          if (updateData.get(key) !== value&&typeof(value)!="object"||updateData_lenght !== formData_length) {
            isDifferent = true;
          }
        };
      }else{
        isDifferent= true
      }

      if(isDifferent){
        $('.loader').removeAttr("style");
        $.ajax({
          type:"POST",
          url:url,
          data:formData,
          processData:false,
          contentType:false,
          headers:{
            "X-CSRFTOKEN":csrfmiddlewaretoken
          },
          success: function(response){
            location.reload()
          }
        });
      }else{
        $('#wrong_info_form_error, #duplicate_form_error').removeAttr('hidden')
      }
    });

    //Delete Return job 
    $("#wrong_delete_id").on("click", function(){
        var status = $("#wrong_return_job_stauts").attr("value")
        var job_id = $("#wrong_info_job_id").attr("value")
      $('#return_job_delete_id').attr('action', `/jobs/return_job_delete/${job_id}/${status}/`)
    });

    // set latitude and longitude
    $("#save_location").on("click", function(){
      const edit_job_address = document.getElementById("edit_wrong_address_id");
      const edit_job_latitude = document.getElementById("wrong_job_latitude");
      const edit_job_longitude = document.getElementById("wrong_job_longitude");
      edit_job_address.value = formatted_address
      edit_job_latitude.value = latitude
      edit_job_longitude.value = longitude
    })

    $("#wrong_add-location").on("click", function(){
      wrongCallMap("")
    })

    $("#static_image").on("click", function(){
      wrongCallMap("wrong_return_job")
    })

    function wrongCallMap(status){
      $("#map_close_btn, #save_location").attr("data-bs-target", "#wrong_return_model")
      $.getScript("https://maps.googleapis.com/maps/api/js?key=" + "{{google_api_key}}" + "&libraries=places&language=he").done(function (script, textStatus) {
        initMap(parseFloat(wrong_latitude), parseFloat(wrong_longitude), map_readonly);
        addressAutocomplete(status);
      });
    }

    $("#duplicate_add-location").on("click", function(){
      $("#map_close_btn, #save_location").attr("data-bs-target", "#duplicate_return_model")
      $.getScript("https://maps.googleapis.com/maps/api/js?key=" + "{{google_api_key}}" + "&libraries=places&language=he").done(function (script, textStatus) {
        google.maps.event.addEventListener(window, "load", initMap(parseFloat(duplicate_latitude), parseFloat(duplicate_longitude), map_readonly))
      })
    })
    $("#original_add-location").on("click", function(){
      $("#map_close_btn").attr("data-bs-target", "#duplicate_return_model")
      $.getScript("https://maps.googleapis.com/maps/api/js?key=" + "{{google_api_key}}" + "&libraries=places&language=he").done(function (script, textStatus) {
        google.maps.event.addEventListener(window, "load", initMap(parseFloat(original_latitude), parseFloat(original_longitude), map_readonly))
      })
    })

    $(".create_job_modal").children(".modal-dialog").css("max-width","456px")


  let dropArea = document.getElementById("wrong_inputfile-docs");

  // Prevent default drag behaviors
  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    dropArea.addEventListener(eventName, preventDefaults, false)   
    document.body.addEventListener(eventName, preventDefaults, false)
  });

  function preventDefaults (e) {
    e.preventDefault()
    e.stopPropagation()
  }

  // Highlight drop area when item is dragged over it
  ['dragenter', 'dragover'].forEach(eventName => {
    dropArea.addEventListener(eventName, function highlight(e) {
      dropArea.classList.add('highlight')
    }, false)
  });

  ['dragleave', 'drop'].forEach(eventName => {
    dropArea.addEventListener(eventName, function unhighlight(e) {
      dropArea.classList.remove('active')
    }, false)
  });

  // Handle dropped files
  dropArea.addEventListener('drop', handleDrop, false);

  function handleDrop(e) {
    var dt = e.dataTransfer
    var files = dt.files
    var input = $('#wrong_inputfile');
    input.files = files;

    var on_change_id = $("#wrong_inputfile").attr("id");
    var dataTransfer = new DataTransfer();
    var files_array = Array.from(files);

    files_array.forEach(function(file) {
      dataTransfer.items.add(file);
    });

    add_media_carousel(dataTransfer.files)
    var newInput = document.createElement("input");
    newInput.type = "file";
    newInput.name = "attachment";
    newInput.classList.add(`wrong_image_carousel_job_media_files`);
    newInput.multiple = true;
    newInput.files = dataTransfer.files;
    newInput.hidden = true
    $(`#${on_change_id}-docs`).append(newInput);
    this.value=""
  }


  function add_media_carousel(files){
    var carousel_id = "wrong_image_carousel"
    var attachment = "#wrong_attechment"
    if (files) {
        for (let i = 0; i < files["length"]; i++) {
            const uniqeId = Date.now()
            var unique_Id = `${uniqeId}_${files[i].size}`
            if ((files[i].type).includes('application/')||(files[i].type).includes("text/")){
                $("#create_docs, #create_doc").removeAttr("hidden")
                $("#wrong_attechment").append(`
                <div class="col-sm-6 position-relative" id="${unique_Id}">
                    <button class="remove_docs close-icon small-icon" type="button" 
                        onclick="doc_remove('${files[i].name}', ${files[i].size}, '${files[i].type}', '${carousel_id}', '', '${unique_Id}', '${attachment}')">
                        <svg width="32" height="32" viewBox="0 0 32 32" stroke="#000000" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M25 7L7 25" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M25 25L7 7"  stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </button>
                    <div class="document_block">
                        <div class="document_name">${(files[i].name).split(".")[1]}</div>
                        <div class="document_info">
                            <p>${files[i].name}</p>
                            <span>${(files[i].size / 1048576).toFixed(2)} MB</span>
                        </div>
                    </div>
                </div>
                `)
            }
            else{
                if ((files[i].type).includes('image/')){
                  $("#wrong_image_carousel.owl-carousel").owlCarousel("add", (`
                    <div class="item">
                      <button class="owl_image_remove close-icon" type="button" 
                        onclick="doc_remove('${files[i].name}', ${files[i].size}, '${files[i].type}', '${carousel_id}', 'wrong_image_carousel')"><svg width="32" height="32" viewBox="0 0 32 32" stroke="#000000" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M25 7L7 25" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M25 25L7 7"  stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                      </button>
                      <img id="create_attachment_image-${uniqeId}">
                    </div>
                  `));
                }
                else if((files[i].type).includes('video/')){
                  $("#wrong_image_carousel.owl-carousel").owlCarousel("add", (`
                    <div class="item"> 
                      <button class="owl_image_remove close-icon" type="button" 
                      onclick="doc_remove('${files[i].name}', ${files[i].size}, '${files[i].type}', '${carousel_id}', 'wrong_image_carousel')">
                      <svg width="32" height="32" viewBox="0 0 32 32" stroke="#000000" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M25 7L7 25" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                      <path d="M25 25L7 7"  stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                      </button>
                      <video id="create_attachment_image-${uniqeId}" type="video/*" controls></video>
                    </div>
                  `));
                }

                let reader = new FileReader();
                reader.onload = function (event) {
                  var base64Data = event.target.result;
    
                    base64Data = base64Data.replace(/^data:video\/quicktime/, 'data:video/mp4');
                    $(`#create_attachment_image-${uniqeId}`).attr("src", base64Data);
                };
                $(".owl-carousel").owlCarousel("update");
                reader.readAsDataURL(files[i]);

                if(i==0){
                    $("#default_image_carousel").hide()
                    $("#wrong_image_carousel").attr("hidden", false)
                }
                $('.owl-carousel').trigger('refresh.owl.carousel');
            }
        }
    }
  }

  function drag_drop_media(){
    var dataTransfer = new DataTransfer();
    var files = Array.from(this.files);

    files.forEach(function(file) {
      dataTransfer.items.add(file);
    });

    var newInput = document.createElement("input");
    newInput.type = "file";
    newInput.name = "attachment";
    newInput.multiple = true;
    newInput.classList.add(`wrong_image_carousel_job_media_files`);
    newInput.files = dataTransfer.files;
    newInput.hidden = true
    $(`#wrong_inputfile-docs`).append(newInput);
    this.value=""
  }

  var quary_parmas = new URLSearchParams(window.location.search)
  if(window.location.search){
    call_ajax(quary_parmas.get("redirect_job_id"), String(quary_parmas.get("status")))

    if(String(quary_parmas.get("status"))=="לְשַׁכְפֵּל"){
      $("#duplicate_return_btn").attr("id_data", quary_parmas.get("redirect_job_id"))
      $("#duplicate_return_btn").attr("status_data", String(quary_parmas.get("status")))
      $("#duplicate_return_btn").click()
    }else if(String(quary_parmas.get("status"))=="מידע שגוי"){
      $("#wrong_return_btn").attr("id_data", quary_parmas.get("redirect_job_id"))
      $("#wrong_return_btn").attr("status_data", String(quary_parmas.get("status")))
      $("#wrong_return_btn").click()
    } 
  }

  });
</script>
{% endblock %}